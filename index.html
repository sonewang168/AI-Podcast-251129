<!DOCTYPE html>
<html lang="zh-TW" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>AI Podcast Â∑•‰ΩúÁ´ô - Cyber Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        }
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        cyber: {
                            bg: '#0a0a0f',
                            card: '#0d1117',
                            elevated: '#161b22',
                            border: '#30363d',
                            cyan: '#00d4ff',
                            purple: '#a855f7',
                            green: '#00ff88',
                            pink: '#ff0080',
                            orange: '#ff6b35',
                            yellow: '#ffd60a',
                        }
                    },
                    fontFamily: {
                        orbitron: ['Orbitron', 'monospace'],
                        rajdhani: ['Rajdhani', 'sans-serif'],
                        mono: ['Share Tech Mono', 'monospace'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Rajdhani', sans-serif;
            background: #0a0a0f;
            min-height: 100vh;
        }
        
        /* Animated Background */
        .cyber-bg {
            position: fixed;
            inset: 0;
            z-index: -1;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(0, 212, 255, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(168, 85, 247, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(0, 255, 136, 0.03) 0%, transparent 70%),
                linear-gradient(180deg, #0a0a0f 0%, #0d1117 50%, #0a0a0f 100%);
        }
        
        .grid-overlay {
            position: fixed;
            inset: 0;
            z-index: -1;
            background-image: 
                linear-gradient(rgba(0, 212, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 212, 255, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
            animation: gridMove 30s linear infinite;
        }
        
        @keyframes gridMove {
            0% { transform: translateY(0); }
            100% { transform: translateY(40px); }
        }
        
        .scan-line {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, #00d4ff, transparent);
            z-index: 9999;
            animation: scan 5s linear infinite;
            opacity: 0.4;
            pointer-events: none;
        }
        
        @keyframes scan {
            0% { top: 0; opacity: 0; }
            10% { opacity: 0.4; }
            90% { opacity: 0.4; }
            100% { top: 100%; opacity: 0; }
        }
        
        /* Glow Effects */
        .glow-cyan { 
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.3), inset 0 0 20px rgba(0, 212, 255, 0.05);
            border-color: rgba(0, 212, 255, 0.5);
        }
        .glow-green { 
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3), inset 0 0 20px rgba(0, 255, 136, 0.05);
            border-color: rgba(0, 255, 136, 0.5);
        }
        .glow-purple { 
            box-shadow: 0 0 20px rgba(168, 85, 247, 0.3), inset 0 0 20px rgba(168, 85, 247, 0.05);
            border-color: rgba(168, 85, 247, 0.5);
        }
        .glow-orange { 
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.3), inset 0 0 20px rgba(255, 107, 53, 0.05);
            border-color: rgba(255, 107, 53, 0.5);
        }
        
        .text-glow-cyan { text-shadow: 0 0 10px rgba(0, 212, 255, 0.8), 0 0 20px rgba(0, 212, 255, 0.4); }
        .text-glow-green { text-shadow: 0 0 10px rgba(0, 255, 136, 0.8), 0 0 20px rgba(0, 255, 136, 0.4); }
        .text-glow-purple { text-shadow: 0 0 10px rgba(168, 85, 247, 0.8), 0 0 20px rgba(168, 85, 247, 0.4); }
        
        /* Cyber Card */
        .cyber-card {
            background: rgba(13, 17, 23, 0.8);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }
        
        .cyber-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, #00d4ff, transparent);
            opacity: 0.5;
        }
        
        .cyber-card:hover {
            border-color: rgba(0, 212, 255, 0.4);
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.15);
        }
        
        /* Cyber Input */
        .cyber-input {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 8px;
            color: #e6edf3;
            font-family: 'Rajdhani', sans-serif;
            transition: all 0.3s ease;
        }
        
        .cyber-input:focus {
            border-color: #00d4ff;
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.3), inset 0 0 10px rgba(0, 212, 255, 0.05);
            outline: none;
        }
        
        .cyber-input::placeholder { color: #6e7681; }
        
        /* Select dropdown styling */
        select.cyber-input {
            cursor: pointer;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url('data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2724%27 height=%2724%27 fill=%27%2300d4ff%27 viewBox=%270 0 24 24%27%3E%3Cpath d=%27M7 10l5 5 5-5z%27/%3E%3C/svg%3E');
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 20px;
            padding-right: 40px !important;
        }
        
        select.cyber-input option {
            background: #0d1117;
            color: #e6edf3;
            padding: 10px;
        }
        
        select.cyber-input option:hover,
        select.cyber-input option:checked {
            background: rgba(0, 212, 255, 0.2);
        }
        
        /* Cyber Button */
        .cyber-btn {
            font-family: 'Orbitron', monospace;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
            border: 1px solid;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .cyber-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s ease;
        }
        
        .cyber-btn:hover::before { left: 100%; }
        .cyber-btn:active { transform: scale(0.98); }
        .cyber-btn:disabled { opacity: 0.4; cursor: not-allowed; }
        
        .cyber-btn-cyan {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(0, 212, 255, 0.1));
            border-color: #00d4ff;
            color: #00d4ff;
        }
        .cyber-btn-cyan:hover { box-shadow: 0 0 25px rgba(0, 212, 255, 0.4); }
        
        .cyber-btn-green {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.2), rgba(0, 255, 136, 0.1));
            border-color: #00ff88;
            color: #00ff88;
        }
        .cyber-btn-green:hover { box-shadow: 0 0 25px rgba(0, 255, 136, 0.4); }
        
        .cyber-btn-purple {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.2), rgba(168, 85, 247, 0.1));
            border-color: #a855f7;
            color: #a855f7;
        }
        .cyber-btn-purple:hover { box-shadow: 0 0 25px rgba(168, 85, 247, 0.4); }
        
        .cyber-btn-orange {
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.2), rgba(255, 107, 53, 0.1));
            border-color: #ff6b35;
            color: #ff6b35;
        }
        
        /* Tab Bar */
        .tab-bar {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 480px;
            background: rgba(10, 10, 15, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(0, 212, 255, 0.2);
            z-index: 1000;
        }
        
        .tab-item {
            transition: all 0.3s ease;
            color: #6e7681;
        }
        
        .tab-item.active {
            color: #00d4ff;
        }
        
        .tab-item.active svg {
            filter: drop-shadow(0 0 8px rgba(0, 212, 255, 0.6));
        }
        
        /* Page Transitions */
        .page { display: none; animation: pageIn 0.4s ease; }
        .page.active { display: block; }
        
        @keyframes pageIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Status Indicator */
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .status-dot.off { background: #ff3366; box-shadow: 0 0 10px #ff3366; }
        .status-dot.on { background: #00ff88; box-shadow: 0 0 10px #00ff88; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Knob Control */
        .knob-outer {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(145deg, #161b22, #0d1117);
            box-shadow: 
                inset 4px 4px 10px rgba(0, 0, 0, 0.5),
                inset -4px -4px 10px rgba(255, 255, 255, 0.02),
                0 0 20px rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            cursor: ns-resize;
            touch-action: none;
            position: relative;
        }
        
        .knob-indicator {
            position: absolute;
            top: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            background: #00ff88;
            border-radius: 50%;
            box-shadow: 0 0 10px #00ff88;
        }
        
        /* EQ Slider */
        .eq-track {
            width: 6px;
            height: 100px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 3px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0, 212, 255, 0.2);
        }
        
        .eq-fill {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: linear-gradient(to top, #00d4ff, #00ff88, #ffd60a);
            border-radius: 3px;
            transition: height 0.2s ease;
        }
        
        .eq-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100px;
            height: 6px;
            background: transparent;
            transform: rotate(-90deg);
            position: absolute;
            cursor: pointer;
        }
        
        .eq-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: linear-gradient(145deg, #2d3748, #1a202c);
            border-radius: 50%;
            border: 2px solid #00d4ff;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }
        
        /* Voice Card */
        .voice-card {
            background: linear-gradient(135deg, rgba(22, 27, 34, 0.9), rgba(13, 17, 23, 0.9));
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 12px;
        }
        
        /* Upload Area */
        .upload-area {
            border: 2px dashed rgba(0, 212, 255, 0.3);
            border-radius: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .upload-area:hover, .upload-area.dragover {
            border-color: #00d4ff;
            background: rgba(0, 212, 255, 0.05);
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.2);
        }
        
        /* Loading Spinner */
        .cyber-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(0, 212, 255, 0.2);
            border-top-color: #00d4ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Toast */
        .toast {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(-20px);
            background: rgba(13, 17, 23, 0.95);
            border: 1px solid rgba(0, 212, 255, 0.3);
            padding: 14px 24px;
            border-radius: 12px;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 500;
            z-index: 9999;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
        .toast.success { border-left: 4px solid #00ff88; color: #00ff88; }
        .toast.error { border-left: 4px solid #ff3366; color: #ff3366; }
        .toast.info { border-left: 4px solid #00d4ff; color: #00d4ff; }
        
        /* Script Preview */
        .script-preview {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 8px;
            font-family: 'Rajdhani', sans-serif;
            color: #e6edf3;
            line-height: 1.7;
        }
        
        .script-preview:empty::before {
            content: 'ËÖ≥Êú¨Â∞áÂú®Ê≠§ËôïÈ°ØÁ§∫...';
            color: #6e7681;
        }
        
        /* History Item */
        .history-item {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 212, 255, 0.1);
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .history-item:hover {
            border-color: rgba(0, 212, 255, 0.3);
            background: rgba(0, 212, 255, 0.05);
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.2); border-radius: 3px; }
        ::-webkit-scrollbar-thumb { background: rgba(0, 212, 255, 0.3); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(0, 212, 255, 0.5); }
        
        /* API Badge */
        .api-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 1px;
        }
        
        .api-badge.gemini { background: rgba(0, 212, 255, 0.2); color: #00d4ff; border: 1px solid rgba(0, 212, 255, 0.3); }
        .api-badge.elevenlabs { background: rgba(168, 85, 247, 0.2); color: #a855f7; border: 1px solid rgba(168, 85, 247, 0.3); }
        
        /* Title Suggestion */
        .title-item {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 212, 255, 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .title-item:hover {
            border-color: rgba(0, 212, 255, 0.4);
            background: rgba(0, 212, 255, 0.1);
        }
        
        /* Segment Control */
        .cyber-segment {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 8px;
            padding: 4px;
        }
        
        .segment-btn {
            font-family: 'Rajdhani', sans-serif;
            font-weight: 600;
            letter-spacing: 1px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        
        .segment-btn.active {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(0, 212, 255, 0.1));
            color: #00d4ff;
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
        }
        
        /* Audio Player */
        .audio-container {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(168, 85, 247, 0.1));
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 12px;
        }
        
        audio { width: 100%; height: 50px; border-radius: 8px; }
        audio::-webkit-media-controls-panel { background: rgba(22, 27, 34, 0.9); }
        
        /* ElevenLabs Voice Grid */
        .voice-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        
        .voice-option {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(168, 85, 247, 0.2);
            border-radius: 8px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .voice-option:hover, .voice-option.selected {
            border-color: #a855f7;
            background: rgba(168, 85, 247, 0.1);
            box-shadow: 0 0 15px rgba(168, 85, 247, 0.3);
        }
        
        .voice-option.selected {
            border-width: 2px;
        }
        
        /* ==================== SPLASH SCREEN ==================== */
        .splash-screen {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #0a0a0f;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 99999;
            transition: opacity 0.8s ease, visibility 0.8s ease;
            overflow: hidden;
        }
        
        .splash-screen::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: 
                radial-gradient(ellipse at 30% 30%, rgba(0, 212, 255, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 70%, rgba(168, 85, 247, 0.15) 0%, transparent 50%);
            animation: bgPulse 4s ease-in-out infinite;
        }
        
        @keyframes bgPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        .splash-screen.hide {
            opacity: 0;
            visibility: hidden;
        }
        
        .splash-content {
            text-align: center;
            position: relative;
            z-index: 1;
        }
        
        .splash-logo {
            position: relative;
            width: 140px;
            height: 140px;
            margin: 0 auto 40px;
        }
        
        /* Main Logo Circle */
        .logo-circle {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #00d4ff 0%, #a855f7 50%, #ff0080 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                0 0 60px rgba(0, 212, 255, 0.5),
                0 0 100px rgba(168, 85, 247, 0.3),
                inset 0 0 30px rgba(255, 255, 255, 0.1);
            animation: logoPulse 2s ease-in-out infinite;
            position: relative;
        }
        
        .logo-circle::before {
            content: '';
            position: absolute;
            inset: 3px;
            background: #0a0a0f;
            border-radius: 50%;
        }
        
        .logo-icon {
            position: relative;
            z-index: 1;
            font-size: 3.5em;
            animation: iconFloat 3s ease-in-out infinite;
            filter: drop-shadow(0 0 20px rgba(0, 212, 255, 0.8));
        }
        
        /* Outer Rotating Ring */
        .logo-ring {
            position: absolute;
            top: -15px; left: -15px; right: -15px; bottom: -15px;
            border: 2px solid transparent;
            border-top-color: #00d4ff;
            border-right-color: #a855f7;
            border-radius: 50%;
            animation: ringRotate 3s linear infinite;
        }
        
        .logo-ring::before {
            content: '';
            position: absolute;
            top: -4px; left: 50%;
            width: 8px; height: 8px;
            background: #00d4ff;
            border-radius: 50%;
            transform: translateX(-50%);
            box-shadow: 0 0 15px #00d4ff, 0 0 30px #00d4ff;
        }
        
        /* Inner Rotating Ring */
        .logo-ring-inner {
            position: absolute;
            top: -8px; left: -8px; right: -8px; bottom: -8px;
            border: 1px solid transparent;
            border-bottom-color: #ff0080;
            border-left-color: #00ff88;
            border-radius: 50%;
            animation: ringRotateReverse 2s linear infinite;
        }
        
        .logo-ring-inner::before {
            content: '';
            position: absolute;
            bottom: -3px; left: 50%;
            width: 6px; height: 6px;
            background: #ff0080;
            border-radius: 50%;
            transform: translateX(-50%);
            box-shadow: 0 0 10px #ff0080;
        }
        
        /* Orbiting Particles */
        .logo-particles {
            position: absolute;
            top: 50%; left: 50%;
            width: 100%; height: 100%;
            transform: translate(-50%, -50%);
            animation: particlesRotate 8s linear infinite;
        }
        
        .particle {
            position: absolute;
            width: 4px; height: 4px;
            background: #00d4ff;
            border-radius: 50%;
            box-shadow: 0 0 10px currentColor;
        }
        
        .particle:nth-child(1) { top: -20px; left: 50%; background: #00d4ff; }
        .particle:nth-child(2) { top: 50%; right: -20px; background: #a855f7; }
        .particle:nth-child(3) { bottom: -20px; left: 50%; background: #ff0080; }
        .particle:nth-child(4) { top: 50%; left: -20px; background: #00ff88; }
        
        @keyframes logoPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes iconFloat {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-8px) rotate(5deg); }
        }
        
        @keyframes ringRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes ringRotateReverse {
            from { transform: rotate(360deg); }
            to { transform: rotate(0deg); }
        }
        
        @keyframes particlesRotate {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        .splash-title {
            font-family: 'Orbitron', monospace;
            font-size: 2em;
            font-weight: 700;
            background: linear-gradient(135deg, #00d4ff 0%, #a855f7 50%, #ff0080 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            letter-spacing: 4px;
            text-shadow: 0 0 30px rgba(0, 212, 255, 0.5);
            animation: titleGlow 2s ease-in-out infinite;
        }
        
        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }
        
        .splash-subtitle {
            font-family: 'Rajdhani', sans-serif;
            color: #6e7681;
            font-size: 1em;
            letter-spacing: 3px;
            margin-bottom: 50px;
        }
        
        .splash-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .loading-bar {
            width: 200px;
            height: 3px;
            background: rgba(0, 212, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
            position: relative;
        }
        
        .loading-bar::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, #00d4ff, #a855f7, transparent);
            animation: loadingSlide 1.5s ease-in-out infinite;
        }
        
        @keyframes loadingSlide {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .loading-dots {
            display: flex;
            gap: 10px;
        }
        
        .loading-dots span {
            width: 10px;
            height: 10px;
            background: linear-gradient(135deg, #00d4ff, #a855f7);
            border-radius: 50%;
            animation: dotBounce 1.4s ease-in-out infinite;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }
        
        .loading-dots span:nth-child(1) { animation-delay: 0s; }
        .loading-dots span:nth-child(2) { animation-delay: 0.2s; }
        .loading-dots span:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes dotBounce {
            0%, 80%, 100% { transform: scale(0.6); opacity: 0.5; }
            40% { transform: scale(1.2); opacity: 1; }
        }
        
        .loading-text {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.85em;
            color: #00d4ff;
            letter-spacing: 2px;
            animation: textFlicker 3s ease-in-out infinite;
        }
        
        @keyframes textFlicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
            52% { opacity: 1; }
            54% { opacity: 0.7; }
            56% { opacity: 1; }
        }
        
        .splash-footer {
            position: absolute;
            bottom: 40px;
            color: #3d4450;
            font-family: 'Orbitron', monospace;
            font-size: 0.7em;
            letter-spacing: 2px;
        }
        
        /* Scan Line Effect on Splash */
        .splash-scan {
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, #00d4ff, transparent);
            animation: splashScan 2s linear infinite;
            opacity: 0.6;
        }
        
        @keyframes splashScan {
            0% { top: 0; }
            100% { top: 100%; }
        }
    </style>
</head>
<body class="text-gray-100">
    <!-- üé¨ Cyber Splash Screen -->
    <div id="splashScreen" class="splash-screen">
        <div class="splash-scan"></div>
        <div class="splash-content">
            <div class="splash-logo">
                <div class="logo-circle">
                    <div class="logo-icon">üéôÔ∏è</div>
                </div>
                <div class="logo-ring"></div>
                <div class="logo-ring-inner"></div>
                <div class="logo-particles">
                    <div class="particle"></div>
                    <div class="particle"></div>
                    <div class="particle"></div>
                    <div class="particle"></div>
                </div>
            </div>
            <div class="splash-title">AI PODCAST</div>
            <div class="splash-subtitle">CYBER EDITION</div>
            <div class="splash-loading">
                <div class="loading-bar"></div>
                <div class="loading-dots">
                    <span></span><span></span><span></span>
                </div>
                <div class="loading-text">INITIALIZING SYSTEM...</div>
            </div>
        </div>
        <div class="splash-footer">CREATED BY SONE WANG ¬© 2025</div>
    </div>
    <div class="cyber-bg"></div>
    <div class="grid-overlay"></div>
    <div class="scan-line"></div>
    
    <!-- App Container -->
    <div class="max-w-lg mx-auto min-h-screen relative pb-24">
        <!-- Status Bar -->
        <div class="sticky top-0 z-50 bg-black/90 backdrop-blur-xl border-b border-cyan-500/20 px-5 py-3">
            <div class="flex justify-between items-center">
                <div class="font-orbitron text-sm font-semibold text-cyan-400 text-glow-cyan" id="statusTime">00:00</div>
                <div class="flex items-center gap-3">
                    <div class="flex items-center gap-2 px-3 py-1 bg-black/40 rounded-full border border-cyan-500/20">
                        <div class="status-dot off" id="connDot"></div>
                        <span class="text-xs font-medium text-gray-400" id="connText">Èõ¢Á∑ö</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Navigation -->
        <div class="px-5 py-4 bg-gradient-to-b from-black/80 to-transparent">
            <h1 class="font-orbitron text-2xl font-bold bg-gradient-to-r from-cyan-400 via-purple-500 to-pink-500 bg-clip-text text-transparent" id="navTitle">AI PODCAST</h1>
            <p class="text-sm text-gray-500 mt-1 tracking-wide">CYBER EDITION ‚Ä¢ TTS & SCRIPT GENERATOR</p>
        </div>
        
        <!-- Main Content -->
        <div class="px-4 space-y-4">
            
            <!-- ==================== HOME PAGE ==================== -->
            <div class="page active" id="homePage">
                
                <!-- API Configuration Card -->
                <div class="cyber-card p-4 mb-4">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="font-orbitron text-xs font-semibold text-cyan-400 tracking-widest text-glow-cyan">API CONFIGURATION</h2>
                        <div class="flex gap-2">
                            <span class="api-badge gemini" id="geminiBadge">GEMINI</span>
                            <span class="api-badge elevenlabs opacity-40" id="elevenBadge">ELEVENLABS</span>
                        </div>
                    </div>
                    
                    <!-- API Type Selector -->
                    <div class="flex gap-2 mb-4">
                        <button class="flex-1 py-3 px-4 rounded-lg font-rajdhani font-semibold text-sm transition-all border border-cyan-500/50 bg-cyan-500/10 text-cyan-400" id="apiTabGemini" onclick="selectApiType('gemini')">
                            <span class="block">ü§ñ Google Gemini</span>
                            <span class="text-xs opacity-60">ËÖ≥Êú¨ + TTS</span>
                        </button>
                        <button class="flex-1 py-3 px-4 rounded-lg font-rajdhani font-semibold text-sm transition-all border border-purple-500/30 bg-transparent text-gray-400" id="apiTabEleven" onclick="selectApiType('elevenlabs')">
                            <span class="block">üéôÔ∏è ElevenLabs</span>
                            <span class="text-xs opacity-60">È´òÂìÅË≥™Ë™ûÈü≥</span>
                        </button>
                    </div>
                    
                    <!-- Gemini API Input -->
                    <div id="geminiApiSection">
                        <label class="block text-xs text-gray-500 mb-2 tracking-wide">GOOGLE AI STUDIO API KEY</label>
                        <div class="flex gap-2">
                            <input type="password" class="cyber-input flex-1 px-4 py-3 text-sm" id="geminiApiKey" placeholder="Ëº∏ÂÖ• Gemini API Key...">
                            <button class="cyber-btn cyber-btn-cyan px-5 py-3 text-xs" id="connectGeminiBtn" onclick="connectGemini()">ÈÄ£Á∑ö</button>
                        </div>
                    </div>
                    
                    <!-- ElevenLabs API Input -->
                    <div id="elevenApiSection" class="hidden">
                        <label class="block text-xs text-gray-500 mb-2 tracking-wide">ELEVENLABS API KEY</label>
                        <div class="flex gap-2 mb-3">
                            <input type="password" class="cyber-input flex-1 px-4 py-3 text-sm" id="elevenApiKey" placeholder="Ëº∏ÂÖ• ElevenLabs API Key...">
                            <button class="cyber-btn cyber-btn-purple px-5 py-3 text-xs" id="connectElevenBtn" onclick="connectElevenLabs()">ÈÄ£Á∑ö</button>
                        </div>
                        <p class="text-xs text-gray-600">üí° ElevenLabs Êèê‰æõÊõ¥È´òÂìÅË≥™ÁöÑË™ûÈü≥ÂêàÊàêÔºåÊîØÊè¥Â§öÁ®ÆË™ûË®ÄÂíåËÅ≤Èü≥È¢®Ê†º</p>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <h2 class="font-orbitron text-xs font-semibold text-cyan-400 tracking-widest mb-3 text-glow-cyan">QUICK ACTIONS</h2>
                <div class="grid grid-cols-2 gap-3 mb-4">
                    <button class="cyber-card p-4 text-center hover:glow-cyan transition-all" onclick="switchPage('create')">
                        <div class="w-12 h-12 mx-auto mb-3 rounded-xl bg-gradient-to-br from-cyan-500/30 to-blue-500/30 flex items-center justify-center border border-cyan-500/30">
                            <svg class="w-6 h-6 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
                        </div>
                        <div class="font-semibold text-sm text-gray-200">ÁîüÊàêËÖ≥Êú¨</div>
                        <div class="text-xs text-gray-500 mt-1">AI Ââµ‰Ωú Podcast</div>
                    </button>
                    <button class="cyber-card p-4 text-center hover:glow-green transition-all" onclick="switchPage('voice')">
                        <div class="w-12 h-12 mx-auto mb-3 rounded-xl bg-gradient-to-br from-green-500/30 to-emerald-500/30 flex items-center justify-center border border-green-500/30">
                            <svg class="w-6 h-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/></svg>
                        </div>
                        <div class="font-semibold text-sm text-gray-200">Ë™ûÈü≥ÂêàÊàê</div>
                        <div class="text-xs text-gray-500 mt-1">ÊñáÂ≠óËΩâË™ûÈü≥</div>
                    </button>
                    <button class="cyber-card p-4 text-center hover:glow-orange transition-all" onclick="switchPage('history')">
                        <div class="w-12 h-12 mx-auto mb-3 rounded-xl bg-gradient-to-br from-orange-500/30 to-yellow-500/30 flex items-center justify-center border border-orange-500/30">
                            <svg class="w-6 h-6 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        </div>
                        <div class="font-semibold text-sm text-gray-200">Ê≠∑Âè≤Á¥ÄÈåÑ</div>
                        <div class="text-xs text-gray-500 mt-1">Êü•ÁúãÈÅéÂæÄÁîüÊàê</div>
                    </button>
                    <button class="cyber-card p-4 text-center hover:glow-purple transition-all" onclick="switchPage('settings')">
                        <div class="w-12 h-12 mx-auto mb-3 rounded-xl bg-gradient-to-br from-purple-500/30 to-pink-500/30 flex items-center justify-center border border-purple-500/30">
                            <svg class="w-6 h-6 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><circle cx="12" cy="12" r="3"/></svg>
                        </div>
                        <div class="font-semibold text-sm text-gray-200">Ë®≠ÂÆö</div>
                        <div class="text-xs text-gray-500 mt-1">Ë™øÊï¥ÂÅèÂ•ΩË®≠ÂÆö</div>
                    </button>
                </div>
                
                <!-- Recent Activity -->
                <div class="cyber-card p-4">
                    <h2 class="font-orbitron text-xs font-semibold text-cyan-400 tracking-widest mb-3 text-glow-cyan">RECENT ACTIVITY</h2>
                    <div id="recentList" class="space-y-2">
                        <div class="text-center py-8 text-gray-600">
                            <svg class="w-16 h-16 mx-auto mb-3 opacity-30" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/></svg>
                            <p class="font-medium">Â∞öÁÑ°Á¥ÄÈåÑ</p>
                            <p class="text-sm mt-1">ÈñãÂßãÂâµ‰ΩúÊÇ®ÁöÑÁ¨¨‰∏ÄÂÄã Podcast</p>
                        </div>
                    </div>
                </div>
                
                <!-- Footer -->
                <div class="text-center py-6 text-gray-600 text-xs">
                    <p class="font-orbitron tracking-widest">AI PODCAST CYBER EDITION</p>
                    <p class="mt-1">Created by Sone Wang ¬© 2025</p>
                </div>
            </div>
            
            <!-- ==================== CREATE PAGE ==================== -->
            <div class="page" id="createPage">
                
                <!-- Source Material -->
                <div class="cyber-card p-4 mb-4">
                    <h2 class="font-orbitron text-xs font-semibold text-cyan-400 tracking-widest mb-3 text-glow-cyan">DATA SOURCE</h2>
                    
                    <div class="upload-area p-6 text-center mb-3" id="uploadArea">
                        <input type="file" id="fileInput" accept=".txt,.pdf,.png,.jpg,.jpeg,.doc,.docx" hidden>
                        <svg class="w-12 h-12 mx-auto mb-3 text-cyan-500/50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/></svg>
                        <p class="font-semibold text-gray-300">ÈªûÊìäÊàñÊãñÊîæÊ™îÊ°à</p>
                        <p class="text-sm text-gray-500 mt-1">ÊîØÊè¥ PDF„ÄÅTXT„ÄÅÂúñÁâá</p>
                    </div>
                    
                    <div id="fileStatus" class="hidden mb-3 p-3 bg-black/30 rounded-lg border border-cyan-500/30">
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-cyan-400" id="fileName"></span>
                            <button class="text-xs text-red-400 hover:text-red-300" id="removeFile">ÁßªÈô§</button>
                        </div>
                    </div>
                    
                    <!-- Image Processing Options -->
                    <div id="imageOptions" class="hidden mb-3 p-3 bg-purple-500/10 rounded-lg border border-purple-500/30">
                        <p class="text-xs text-purple-400 mb-2 font-semibold">ÂúñÂÉèËôïÁêÜÊ®°Âºè</p>
                        <div class="flex gap-4 mb-2">
                            <label class="flex items-center text-sm text-gray-400 cursor-pointer">
                                <input type="radio" name="imageMode" value="ocr" checked class="mr-2 accent-purple-500"> ÊñáÂ≠óËß£Êûê (OCR)
                            </label>
                            <label class="flex items-center text-sm text-gray-400 cursor-pointer">
                                <input type="radio" name="imageMode" value="describe" class="mr-2 accent-purple-500"> ÊÑèÂ¢ÉÊèèËø∞
                            </label>
                        </div>
                        <button class="cyber-btn cyber-btn-purple w-full py-2 text-xs" id="processImageBtn">ËôïÁêÜÂúñÂÉè</button>
                    </div>
                    
                    <textarea class="cyber-input w-full p-4 text-sm min-h-[120px] resize-none" id="sourceText" placeholder="ÊàñÁõ¥Êé•Âú®Ê≠§Ë≤º‰∏äÂéüÂßãÊñáÁ´†..."></textarea>
                </div>
                
                <!-- Script Settings -->
                <div class="cyber-card p-4 mb-4">
                    <h2 class="font-orbitron text-xs font-semibold text-cyan-400 tracking-widest mb-3 text-glow-cyan">SCRIPT SETTINGS</h2>
                    
                    <!-- Mode Toggle -->
                    <div class="cyber-segment flex mb-4">
                        <button class="segment-btn flex-1 py-2 text-sm active" data-mode="single" onclick="setScriptMode('single')">ÂñÆ‰∫∫Ê®°Âºè</button>
                        <button class="segment-btn flex-1 py-2 text-sm text-gray-500" data-mode="dual" onclick="setScriptMode('dual')">Èõô‰∫∫Â∞çË´á</button>
                    </div>
                    
                    <!-- Speaker 1 -->
                    <div class="space-y-3 mb-4">
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">Ë¨õËÄÖ 1 ÂêçÁ®±</label>
                            <input type="text" class="cyber-input w-full px-4 py-2 text-sm" id="speaker1Name" value="ÁõäÂ∏´ÂÇÖ">
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">Ë¨õËÄÖ 1 Á∞°‰ªã (ÈÅ∏Â°´)</label>
                            <input type="text" class="cyber-input w-full px-4 py-2 text-sm" id="speaker1Intro" placeholder="‰æãÂ¶ÇÔºöË≥áÊ∑±ÁßëÊäÄË©ïË´ñÂì°">
                        </div>
                    </div>
                    
                    <!-- Speaker 2 (Hidden by default) -->
                    <div id="speaker2Box" class="hidden space-y-3 mb-4 pt-4 border-t border-cyan-500/20">
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">Ë¨õËÄÖ 2 ÂêçÁ®±</label>
                            <input type="text" class="cyber-input w-full px-4 py-2 text-sm" id="speaker2Name" value="Rachel">
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">Ë¨õËÄÖ 2 Á∞°‰ªã (ÈÅ∏Â°´)</label>
                            <input type="text" class="cyber-input w-full px-4 py-2 text-sm" id="speaker2Intro" placeholder="‰æãÂ¶ÇÔºöÂÖÖÊªøÂ•ΩÂ•áÂøÉÁöÑË®≠Ë®àÂ∏´">
                        </div>
                    </div>
                    
                    <!-- Style Selection -->
                    <div class="space-y-3">
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">ËÖ≥Êú¨È¢®Ê†º</label>
                            <select class="cyber-input w-full px-4 py-2 text-sm appearance-none bg-right bg-no-repeat" id="scriptStyle" style="background-image: url('data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2724%27 height=%2724%27 fill=%27%2300d4ff%27 viewBox=%270 0 24 24%27%3E%3Cpath d=%27M7 10l5 5 5-5z%27/%3E%3C/svg%3E'); padding-right: 40px;">
                                <option value="podcast">Ê®ôÊ∫ñ Podcast (Ëá™ÁÑ∂)</option>
                                <option value="storybook">ÊúâËÅ≤Êõ∏ - Á´•Ë©±Áπ™Êú¨</option>
                                <option value="report">Â∞àÊ•≠Â†±Âëä - Áèæ‰ª£ÂïÜÂãô</option>
                                <option value="chat">Ëá™ÁÑ∂ÈñíËÅä - ËÅäÂ§©È¢®Ê†º</option>
                                <option value="product">Áî¢ÂìÅ‰ªãÁ¥π - Êñ∞ÂìÅ‰ªãÁ¥π</option>
                                <option value="announcement">Êîø‰ª§ÂÆ£Â∞é - ÂÖ¨ÂëäÈÄöÁü•</option>
                                <option value="bazi">ÂëΩÁõ§ÂàÜÊûê - ÂÖ´Â≠óËß£Áõ§</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">Ë®éË´ñ‰∏ªÈ°å (ÈÅ∏Â°´)</label>
                            <input type="text" class="cyber-input w-full px-4 py-2 text-sm" id="topic" placeholder="‰æãÂ¶ÇÔºöAI Â∞çÊïôËÇ≤ÁöÑÂΩ±Èüø">
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">ÊúüÊúõÂ≠óÊï∏</label>
                            <input type="number" class="cyber-input w-full px-4 py-2 text-sm" id="wordCount" value="2000" min="500" max="10000">
                        </div>
                    </div>
                </div>
                
                <!-- Language Settings -->
                <div class="cyber-card p-4 mb-4">
                    <h2 class="font-orbitron text-xs font-semibold text-cyan-400 tracking-widest mb-3 text-glow-cyan">LANGUAGE</h2>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">‰æÜÊ∫êË™ûË®Ä</label>
                            <select class="cyber-input w-full px-3 py-2 text-sm" id="sourceLang">
                                <option value="zh-TW">ÁπÅÈ´î‰∏≠Êñá</option>
                                <option value="en">English</option>
                                <option value="ja">Êó•Êú¨Ë™û</option>
                                <option value="ko">ÌïúÍµ≠Ïñ¥</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">ÁõÆÊ®ôË™ûË®Ä</label>
                            <select class="cyber-input w-full px-3 py-2 text-sm" id="targetLang">
                                <option value="zh-TW">ÁπÅÈ´î‰∏≠Êñá</option>
                                <option value="en">English</option>
                                <option value="ja">Êó•Êú¨Ë™û</option>
                                <option value="ko">ÌïúÍµ≠Ïñ¥</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Generate Button -->
                <button class="cyber-btn cyber-btn-green w-full py-4 text-sm mb-4" id="generateBtn" disabled onclick="generateScript()">
                    <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                    ÂïüÂãï AI ÁîüÊàêËÖ≥Êú¨
                </button>
                
                <!-- Generated Content -->
                <div id="resultBox" class="hidden space-y-4">
                    
                    <!-- Titles -->
                    <div class="cyber-card p-4">
                        <div class="flex items-center justify-between mb-3">
                            <h2 class="font-orbitron text-xs font-semibold text-cyan-400 tracking-widest text-glow-cyan">SUGGESTED TITLES</h2>
                            <button class="text-xs text-cyan-400 hover:text-cyan-300" id="regenTitles">ÈáçÊñ∞ÁîüÊàê</button>
                        </div>
                        <div id="titlesBox" class="space-y-2"></div>
                    </div>
                    
                    <!-- Summary -->
                    <div class="cyber-card p-4">
                        <div class="flex items-center justify-between mb-3">
                            <h2 class="font-orbitron text-xs font-semibold text-cyan-400 tracking-widest text-glow-cyan">SHOW NOTES</h2>
                            <button class="text-xs text-cyan-400 hover:text-cyan-300" onclick="copyText('summaryBox')">Ë§áË£Ω</button>
                        </div>
                        <div id="summaryBox" class="script-preview p-3 text-sm max-h-32 overflow-y-auto"></div>
                    </div>
                    
                    <!-- Script -->
                    <div class="cyber-card p-4">
                        <div class="flex items-center justify-between mb-3">
                            <h2 class="font-orbitron text-xs font-semibold text-cyan-400 tracking-widest text-glow-cyan">PODCAST SCRIPT</h2>
                            <button class="text-xs text-cyan-400 hover:text-cyan-300" onclick="copyText('scriptBox')">Ë§áË£Ω</button>
                        </div>
                        <div id="scriptBox" class="script-preview p-3 text-sm max-h-64 overflow-y-auto whitespace-pre-wrap" contenteditable="true"></div>
                    </div>
                    
                    <!-- Export Buttons -->
                    <div class="grid grid-cols-2 gap-3">
                        <button class="cyber-btn cyber-btn-orange py-3 text-xs" onclick="downloadPdf()">
                            <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                            ‰∏ãËºâ PDF
                        </button>
                        <button class="cyber-btn cyber-btn-cyan py-3 text-xs" onclick="downloadTxt()">
                            <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                            ‰∏ãËºâ TXT
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- ==================== VOICE PAGE ==================== -->
            <div class="page" id="voicePage">
                
                <!-- TTS Engine Selection -->
                <div class="cyber-card p-4 mb-4">
                    <h2 class="font-orbitron text-xs font-semibold text-cyan-400 tracking-widest mb-3 text-glow-cyan">TTS ENGINE</h2>
                    <div class="cyber-segment flex">
                        <button class="segment-btn flex-1 py-2 text-sm active" data-engine="gemini" onclick="setTTSEngine('gemini')">ü§ñ Gemini TTS</button>
                        <button class="segment-btn flex-1 py-2 text-sm text-gray-500" data-engine="elevenlabs" onclick="setTTSEngine('elevenlabs')">üéôÔ∏è ElevenLabs</button>
                    </div>
                </div>
                
                <!-- Voice Selection - Gemini -->
                <div id="geminiVoiceSection" class="cyber-card p-4 mb-4">
                    <h2 class="font-orbitron text-xs font-semibold text-cyan-400 tracking-widest mb-3 text-glow-cyan">VOICE SELECTION</h2>
                    
                    <!-- Mode Toggle -->
                    <div class="cyber-segment flex mb-4">
                        <button class="segment-btn flex-1 py-2 text-sm active" data-vmode="single" onclick="setVoiceMode('single')">ÂñÆ‰∫∫</button>
                        <button class="segment-btn flex-1 py-2 text-sm text-gray-500" data-vmode="dual" onclick="setVoiceMode('dual')">Èõô‰∫∫</button>
                    </div>
                    
                    <!-- Voice 1 -->
                    <div class="voice-card p-4 mb-3">
                        <div class="flex items-center justify-between mb-3">
                            <span class="font-semibold text-sm">Ë¨õËÄÖ 1</span>
                            <span class="text-xs px-2 py-1 rounded-full bg-cyan-500/20 text-cyan-400" id="badge1">Áî∑ËÅ≤</span>
                        </div>
                        <div class="flex gap-2">
                            <select class="cyber-input flex-1 px-3 py-2 text-sm" id="voice1"></select>
                            <button class="cyber-btn cyber-btn-cyan px-4 py-2 text-xs" id="audition1" disabled onclick="auditionVoice(1)">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Voice 2 -->
                    <div id="voice2Card" class="voice-card p-4 hidden">
                        <div class="flex items-center justify-between mb-3">
                            <span class="font-semibold text-sm">Ë¨õËÄÖ 2</span>
                            <span class="text-xs px-2 py-1 rounded-full bg-pink-500/20 text-pink-400" id="badge2">Â•≥ËÅ≤</span>
                        </div>
                        <div class="flex gap-2">
                            <select class="cyber-input flex-1 px-3 py-2 text-sm" id="voice2"></select>
                            <button class="cyber-btn cyber-btn-purple px-4 py-2 text-xs" id="audition2" disabled onclick="auditionVoice(2)">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Voice Selection - ElevenLabs -->
                <div id="elevenVoiceSection" class="cyber-card p-4 mb-4 hidden">
                    <h2 class="font-orbitron text-xs font-semibold text-purple-400 tracking-widest mb-3 text-glow-purple">ELEVENLABS VOICES</h2>
                    
                    <div class="mb-4">
                        <label class="block text-xs text-gray-500 mb-2">ü§ñ ÈÅ∏ÊìáË™ûÈü≥Ê®°Âûã</label>
                        <select class="cyber-input w-full px-4 py-3 text-sm" id="elevenModel" style="border-color: rgba(168, 85, 247, 0.3);">
                            <option value="eleven_multilingual_v2">üåç Multilingual v2 (Â§öË™ûË®ÄÊé®Ëñ¶)</option>
                            <option value="eleven_turbo_v2_5">‚ö° Turbo v2.5 (Âø´ÈÄüÁîüÊàê)</option>
                            <option value="eleven_multilingual_v1">üåê Multilingual v1</option>
                            <option value="eleven_monolingual_v1">üá∫üá∏ Monolingual v1 (Ëã±ÊñáÂ∞àÁî®)</option>
                            <option value="eleven_turbo_v2">üöÄ Turbo v2</option>
                        </select>
                        <p class="text-xs text-gray-600 mt-1">üí° Multilingual v2 ÊîØÊè¥Â§öÂúãË™ûË®ÄÔºåTurbo ÈÄüÂ∫¶Êõ¥Âø´</p>
                    </div>
                    
                    <div class="mb-3">
                        <label class="block text-xs text-gray-500 mb-2">ÈÅ∏ÊìáË™ûÈü≥</label>
                        <div id="elevenVoiceGrid" class="voice-grid">
                            <div class="voice-option selected" data-voice="21m00Tcm4TlvDq8ikWAM">
                                <div class="text-sm font-semibold">Rachel</div>
                                <div class="text-xs text-gray-500">ÁæéÂºèÂ•≥ËÅ≤</div>
                            </div>
                            <div class="voice-option" data-voice="AZnzlk1XvdvUeBnXmlld">
                                <div class="text-sm font-semibold">Domi</div>
                                <div class="text-xs text-gray-500">Âπ¥ËºïÂ•≥ËÅ≤</div>
                            </div>
                            <div class="voice-option" data-voice="EXAVITQu4vr4xnSDxMaL">
                                <div class="text-sm font-semibold">Bella</div>
                                <div class="text-xs text-gray-500">Ê∫´ÊüîÂ•≥ËÅ≤</div>
                            </div>
                            <div class="voice-option" data-voice="ErXwobaYiN019PkySvjV">
                                <div class="text-sm font-semibold">Antoni</div>
                                <div class="text-xs text-gray-500">Â∞àÊ•≠Áî∑ËÅ≤</div>
                            </div>
                            <div class="voice-option" data-voice="VR6AewLTigWG4xSOukaG">
                                <div class="text-sm font-semibold">Arnold</div>
                                <div class="text-xs text-gray-500">‰ΩéÊ≤âÁî∑ËÅ≤</div>
                            </div>
                            <div class="voice-option" data-voice="pNInz6obpgDQGcFmaJgB">
                                <div class="text-sm font-semibold">Adam</div>
                                <div class="text-xs text-gray-500">‰∏≠Âπ¥Áî∑ËÅ≤</div>
                            </div>
                            <div class="voice-option" data-voice="yoZ06aMxZJJ28mfd3POQ">
                                <div class="text-sm font-semibold">Sam</div>
                                <div class="text-xs text-gray-500">Ê¥ªÂäõÁî∑ËÅ≤</div>
                            </div>
                            <div class="voice-option" data-voice="jBpfuIE2acCO8z3wKNLl">
                                <div class="text-sm font-semibold">Gigi</div>
                                <div class="text-xs text-gray-500">Á´•Èü≥Â•≥ËÅ≤</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ElevenLabs Voice Settings -->
                    <div class="grid grid-cols-2 gap-3 mt-4 pt-4 border-t border-purple-500/20">
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">Á©©ÂÆöÂ∫¶</label>
                            <input type="range" class="w-full accent-purple-500" id="elevenStability" min="0" max="100" value="50">
                            <div class="text-xs text-center text-gray-500 mt-1"><span id="stabilityVal">50</span>%</div>
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">Áõ∏‰ººÂ∫¶</label>
                            <input type="range" class="w-full accent-purple-500" id="elevenSimilarity" min="0" max="100" value="75">
                            <div class="text-xs text-center text-gray-500 mt-1"><span id="similarityVal">75</span>%</div>
                        </div>
                    </div>
                    
                    <!-- ElevenLabs Audition Button -->
                    <button class="cyber-btn cyber-btn-purple w-full py-3 text-sm mt-4" id="auditionEleven" onclick="auditionElevenLabsVoice()" disabled>
                        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"/></svg>
                        üéß Ë©¶ËÅΩÈÅ∏ÊìáÁöÑË™ûÈü≥
                    </button>
                    
                    <div class="mt-3 p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">
                        <p class="text-xs text-yellow-400">
                            ‚ö†Ô∏è <strong>Ê≥®ÊÑèÔºö</strong>ElevenLabs API Âú®ÁÄèË¶ØÂô®‰∏≠ÂèØËÉΩÊúÉÂõ† CORS ÈôêÂà∂ËÄåÂ§±Êïó„ÄÇÂ¶ÇÈÅáÂïèÈ°åÔºåÂª∫Ë≠∞‰ΩøÁî® <strong>Gemini TTS</strong> ‰ΩúÁÇ∫Êõø‰ª£ÊñπÊ°àÔºåÊïàÊûúÂêåÊ®£ÂÑ™ÁßÄÔºÅ
                        </p>
                    </div>
                </div>
                
                <!-- Voice Adjustment -->
                <div class="cyber-card p-4 mb-4" id="voiceAdjustment">
                    <h2 class="font-orbitron text-xs font-semibold text-cyan-400 tracking-widest mb-4 text-glow-cyan">VOICE ADJUSTMENT</h2>
                    <div class="flex justify-around">
                        <div class="text-center">
                            <div class="knob-outer mx-auto" id="pitchKnob">
                                <div class="knob-indicator"></div>
                            </div>
                            <div class="text-xs text-gray-500 mt-3">Èü≥Ë™ø</div>
                            <div class="text-sm font-semibold text-cyan-400 mt-1" id="pitchVal">0</div>
                        </div>
                        <div class="text-center">
                            <div class="knob-outer mx-auto" id="speedKnob">
                                <div class="knob-indicator"></div>
                            </div>
                            <div class="text-xs text-gray-500 mt-3">ÈÄüÂ∫¶</div>
                            <div class="text-sm font-semibold text-cyan-400 mt-1" id="speedVal">1.0x</div>
                        </div>
                    </div>
                </div>
                
                <!-- Equalizer -->
                <div class="cyber-card p-4 mb-4">
                    <h2 class="font-orbitron text-xs font-semibold text-cyan-400 tracking-widest mb-3 text-glow-cyan">EQUALIZER</h2>
                    
                    <!-- Presets -->
                    <div class="flex flex-wrap gap-2 mb-4" id="eqPresets">
                        <button class="px-3 py-1 text-xs rounded-full border border-cyan-500/30 bg-cyan-500/10 text-cyan-400" data-preset="balanced">Âπ≥Ë°°</button>
                        <button class="px-3 py-1 text-xs rounded-full border border-cyan-500/20 text-gray-400" data-preset="rock">ÊêñÊªæ</button>
                        <button class="px-3 py-1 text-xs rounded-full border border-cyan-500/20 text-gray-400" data-preset="pop">ÊµÅË°å</button>
                        <button class="px-3 py-1 text-xs rounded-full border border-cyan-500/20 text-gray-400" data-preset="classical">Âè§ÂÖ∏</button>
                        <button class="px-3 py-1 text-xs rounded-full border border-cyan-500/20 text-gray-400" data-preset="bass">Èáç‰ΩéÈü≥</button>
                        <button class="px-3 py-1 text-xs rounded-full border border-cyan-500/20 text-gray-400" data-preset="vocal">‰∫∫ËÅ≤</button>
                    </div>
                    
                    <!-- EQ Sliders -->
                    <div class="flex justify-between items-end h-32 px-2" id="eqContainer">
                        <!-- Will be populated by JS -->
                    </div>
                </div>
                
                <!-- Text Input -->
                <div class="cyber-card p-4 mb-4">
                    <div class="flex items-center justify-between mb-3">
                        <h2 class="font-orbitron text-xs font-semibold text-cyan-400 tracking-widest text-glow-cyan">TEXT INPUT</h2>
                        <div class="flex items-center gap-3">
                            <button class="text-xs text-purple-400 hover:text-purple-300 transition-colors" onclick="quickTestVoice()">‚ö° Âø´ÈÄüÊ∏¨Ë©¶</button>
                            <span class="text-xs text-gray-500"><span id="charCount">0</span> / 12000</span>
                        </div>
                    </div>
                    <textarea class="cyber-input w-full p-4 text-sm min-h-[150px] resize-none" id="ttsText" placeholder="Ëº∏ÂÖ•Ë¶ÅËΩâÊèõÊàêË™ûÈü≥ÁöÑÊñáÂ≠ó...

ÂñÆ‰∫∫Ê®°ÂºèË´ãÁõ¥Êé•Ëº∏ÂÖ•ÊñáÂ≠ó„ÄÇ
Èõô‰∫∫Ê®°ÂºèË´ãÁî®‰ª•‰∏ãÊ†ºÂºèÔºö
Speaker 1: Ê≠°ËøéÊî∂ËÅØ...
Speaker 2: Â§ßÂÆ∂Â•Ω..."></textarea>
                    
                    <div class="flex gap-3 mt-4">
                        <button class="cyber-btn cyber-btn-green flex-1 py-4 text-sm" id="synthesizeBtn" disabled onclick="synthesizeVoice()">
                            <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"/></svg>
                            ÁîüÊàêË™ûÈü≥
                        </button>
                        <button class="cyber-btn cyber-btn-purple py-4 px-6 text-sm" onclick="synthesizeFirstParagraph()" title="Âè™ÁîüÊàêÂâç 500 Â≠ó">
                            ‚ö° Âø´ÈÄü
                        </button>
                    </div>
                    <p class="text-xs text-gray-600 mt-2 text-center">üí° ÊñáÂ≠óË∂äÈï∑ÁîüÊàêË∂ä‰πÖÔºåÂèØÂÖàÁî®„ÄåÂø´ÈÄü„ÄçÊ∏¨Ë©¶Ë™ûÈü≥ÊïàÊûú</p>
                </div>
                
                <!-- Audio Player -->
                <div id="audioBox" class="audio-container p-4 hidden">
                    <audio id="audioPlayer" controls class="w-full mb-3"></audio>
                    <div class="grid grid-cols-2 gap-3">
                        <button class="cyber-btn cyber-btn-cyan py-3 text-xs" onclick="downloadAudio()">
                            <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                            ‰∏ãËºâÈü≥Ê™î
                        </button>
                        <button class="cyber-btn cyber-btn-orange py-3 text-xs" onclick="mergeAllAudio()">
                            <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/></svg>
                            Âêà‰ΩµÊ≠∑Âè≤
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- ==================== HISTORY PAGE ==================== -->
            <div class="page" id="historyPage">
                <div class="cyber-card p-4">
                    <h2 class="font-orbitron text-xs font-semibold text-cyan-400 tracking-widest mb-4 text-glow-cyan">GENERATION HISTORY</h2>
                    <div id="historyList" class="space-y-3">
                        <div class="text-center py-12 text-gray-600">
                            <svg class="w-20 h-20 mx-auto mb-4 opacity-20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                            <p class="font-semibold">Â∞öÁÑ°Á¥ÄÈåÑ</p>
                            <p class="text-sm mt-1">ÊÇ®ÁîüÊàêÁöÑÈü≥Ê™îÊúÉÈ°ØÁ§∫Âú®ÈÄôË£°</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ==================== SETTINGS PAGE ==================== -->
            <div class="page" id="settingsPage">
                <div class="cyber-card overflow-hidden mb-4">
                    <div class="p-4 flex items-center border-b border-cyan-500/10 hover:bg-cyan-500/5 cursor-pointer">
                        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-cyan-500/30 to-blue-500/30 flex items-center justify-center mr-4 border border-cyan-500/30">
                            <svg class="w-5 h-5 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"/></svg>
                        </div>
                        <div class="flex-1">
                            <div class="font-semibold text-sm">‰ªãÈù¢Ë™ûË®Ä</div>
                            <div class="text-xs text-gray-500">ÁπÅÈ´î‰∏≠Êñá</div>
                        </div>
                        <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                    </div>
                    
                    <div class="p-4 flex items-center border-b border-cyan-500/10 hover:bg-cyan-500/5 cursor-pointer">
                        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-green-500/30 to-emerald-500/30 flex items-center justify-center mr-4 border border-green-500/30">
                            <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"/></svg>
                        </div>
                        <div class="flex-1">
                            <div class="font-semibold text-sm">È†êË®≠Ë™ûÈü≥ÂºïÊìé</div>
                            <div class="text-xs text-gray-500">Google Gemini TTS</div>
                        </div>
                        <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                    </div>
                    
                    <div class="p-4 flex items-center hover:bg-cyan-500/5 cursor-pointer">
                        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-purple-500/30 to-pink-500/30 flex items-center justify-center mr-4 border border-purple-500/30">
                            <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        </div>
                        <div class="flex-1">
                            <div class="font-semibold text-sm">ÈóúÊñº</div>
                            <div class="text-xs text-gray-500">ÁâàÊú¨ 2.0.0 Cyber Edition</div>
                        </div>
                        <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                    </div>
                </div>
                
                <div class="cyber-card overflow-hidden mb-4">
                    <div class="p-4 flex items-center hover:bg-red-500/5 cursor-pointer" onclick="clearAllHistory()">
                        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-red-500/30 to-orange-500/30 flex items-center justify-center mr-4 border border-red-500/30">
                            <svg class="w-5 h-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                        </div>
                        <div class="flex-1">
                            <div class="font-semibold text-sm text-red-400">Ê∏ÖÈô§ÊâÄÊúâÁ¥ÄÈåÑ</div>
                        </div>
                        <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                    </div>
                </div>
                
                <!-- Credits -->
                <div class="text-center py-8 text-gray-600">
                    <div class="font-orbitron text-sm tracking-widest mb-2">AI PODCAST</div>
                    <div class="text-xs">CYBER EDITION v2.0</div>
                    <div class="text-xs mt-2">Created by Sone Wang ¬© 2025</div>
                    <div class="text-xs mt-1 text-gray-700">Powered by Google Gemini & ElevenLabs</div>
                </div>
            </div>
            
        </div>
        
        <!-- Tab Bar -->
        <nav class="tab-bar flex justify-around py-3 px-4">
            <button class="tab-item active flex flex-col items-center" data-page="home" onclick="switchPage('home')">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
                <span class="text-xs mt-1 font-semibold">È¶ñÈ†Å</span>
            </button>
            <button class="tab-item flex flex-col items-center" data-page="create" onclick="switchPage('create')">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
                <span class="text-xs mt-1 font-semibold">Ââµ‰Ωú</span>
            </button>
            <button class="tab-item flex flex-col items-center" data-page="voice" onclick="switchPage('voice')">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/></svg>
                <span class="text-xs mt-1 font-semibold">Ë™ûÈü≥</span>
            </button>
            <button class="tab-item flex flex-col items-center" data-page="history" onclick="switchPage('history')">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                <span class="text-xs mt-1 font-semibold">Á¥ÄÈåÑ</span>
            </button>
            <button class="tab-item flex flex-col items-center" data-page="settings" onclick="switchPage('settings')">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><circle cx="12" cy="12" r="3"/></svg>
                <span class="text-xs mt-1 font-semibold">Ë®≠ÂÆö</span>
            </button>
        </nav>
    </div>
    
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black/90 backdrop-blur-md flex flex-col items-center justify-center z-50 hidden">
        <div class="cyber-spinner mb-4"></div>
        <div class="text-cyan-400 font-rajdhani font-semibold text-lg mb-3" id="loadingText">ËôïÁêÜ‰∏≠...</div>
        <div class="w-64 h-2 bg-gray-800 rounded-full overflow-hidden">
            <div id="loadingProgress" class="h-full bg-gradient-to-r from-cyan-500 via-purple-500 to-pink-500 rounded-full transition-all duration-300" style="width: 0%; animation: loadingPulse 1.5s ease-in-out infinite;"></div>
        </div>
        <div class="text-gray-500 text-xs mt-2 font-mono" id="loadingTime">0.0s</div>
    </div>
    
    <style>
        @keyframes loadingPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
    
    <!-- Toast -->
    <div id="toast" class="toast"></div>

<script>
// ==================== VOICE DATA ====================
const geminiVoices = [
    { name: "Kore", gender: "Â•≥", desc: "Ê∏ÖÊñ∞Ê¥ªÊΩë" },
    { name: "Charon", gender: "Áî∑", desc: "Ê≤âÁ©©Â∞àÊ•≠" },
    { name: "Puck", gender: "Áî∑", desc: "ËºïÈ¨ÜË¶™Âàá" },
    { name: "Fenrir", gender: "Áî∑", desc: "Ê∑±Ê≤âÊúâÂäõ" },
    { name: "Aoede", gender: "Â•≥", desc: "Ê∫´ÊüîÁ¥∞ËÜ©" },
    { name: "Leda", gender: "Â•≥", desc: "ÂÑ™ÈõÖÁü•ÊÄß" },
    { name: "Orus", gender: "Áî∑", desc: "Ê¥ªÂäõÂπ¥Ëºï" },
    { name: "Zephyr", gender: "Áî∑", desc: "ËºïÊüîËàíÁ∑©" }
];

const elevenLabsVoices = [
    { id: "21m00Tcm4TlvDq8ikWAM", name: "Rachel", gender: "Â•≥", desc: "ÁæéÂºèÂ•≥ËÅ≤" },
    { id: "AZnzlk1XvdvUeBnXmlld", name: "Domi", gender: "Â•≥", desc: "Âπ¥ËºïÂ•≥ËÅ≤" },
    { id: "EXAVITQu4vr4xnSDxMaL", name: "Bella", gender: "Â•≥", desc: "Ê∫´ÊüîÂ•≥ËÅ≤" },
    { id: "ErXwobaYiN019PkySvjV", name: "Antoni", gender: "Áî∑", desc: "Â∞àÊ•≠Áî∑ËÅ≤" },
    { id: "VR6AewLTigWG4xSOukaG", name: "Arnold", gender: "Áî∑", desc: "‰ΩéÊ≤âÁî∑ËÅ≤" },
    { id: "pNInz6obpgDQGcFmaJgB", name: "Adam", gender: "Áî∑", desc: "‰∏≠Âπ¥Áî∑ËÅ≤" },
    { id: "yoZ06aMxZJJ28mfd3POQ", name: "Sam", gender: "Áî∑", desc: "Ê¥ªÂäõÁî∑ËÅ≤" },
    { id: "jBpfuIE2acCO8z3wKNLl", name: "Gigi", gender: "Â•≥", desc: "Á´•Èü≥Â•≥ËÅ≤" }
];

const eqPresets = {
    balanced: [0,0,0,0,0,0,0,0,0,0],
    rock: [5,4,2,-2,-3,-1,3,4,5,5],
    pop: [-2,-1,0,2,4,4,2,0,-1,-2],
    classical: [4,3,2,-1,-2,-2,0,2,3,4],
    bass: [6,5,4,2,1,0,0,0,0,0],
    vocal: [-4,-3,-2,1,3,3,1,-1,-2,-3]
};

const eqBands = [60, 170, 310, 600, 1000, 3000, 6000, 12000, 14000, 16000];

// ==================== GLOBAL STATE ====================
let geminiApiKey = '';
let elevenApiKey = '';
let isGeminiConnected = false;
let isElevenConnected = false;
let currentApiType = 'gemini';
let currentTTSEngine = 'gemini';
let scriptMode = 'single';
let voiceMode = 'single';
let pitch = 0;
let speed = 1.0;
let history = [];
let currentAudioUrl = null;
let uploadedContent = null;
let uploadedImageData = null;
let generatedScript = '';
let generatedTitles = [];
let generatedSummary = '';
let selectedElevenVoice = '21m00Tcm4TlvDq8ikWAM';

// Audio Processing
let audioContext, sourceNode, analyserNode;
let biquadFilters = [];
let isAudioProcessingInit = false;

// ==================== DOM ELEMENTS ====================
const $ = id => document.getElementById(id);
const dom = {
    // Status
    statusTime: $('statusTime'),
    connDot: $('connDot'),
    connText: $('connText'),
    
    // API
    geminiApiKey: $('geminiApiKey'),
    elevenApiKey: $('elevenApiKey'),
    apiTabGemini: $('apiTabGemini'),
    apiTabEleven: $('apiTabEleven'),
    geminiApiSection: $('geminiApiSection'),
    elevenApiSection: $('elevenApiSection'),
    geminiBadge: $('geminiBadge'),
    elevenBadge: $('elevenBadge'),
    
    // File Upload
    uploadArea: $('uploadArea'),
    fileInput: $('fileInput'),
    fileStatus: $('fileStatus'),
    fileName: $('fileName'),
    removeFile: $('removeFile'),
    imageOptions: $('imageOptions'),
    processImageBtn: $('processImageBtn'),
    sourceText: $('sourceText'),
    
    // Script Settings
    speaker1Name: $('speaker1Name'),
    speaker1Intro: $('speaker1Intro'),
    speaker2Name: $('speaker2Name'),
    speaker2Intro: $('speaker2Intro'),
    speaker2Box: $('speaker2Box'),
    scriptStyle: $('scriptStyle'),
    topic: $('topic'),
    wordCount: $('wordCount'),
    sourceLang: $('sourceLang'),
    targetLang: $('targetLang'),
    generateBtn: $('generateBtn'),
    resultBox: $('resultBox'),
    titlesBox: $('titlesBox'),
    summaryBox: $('summaryBox'),
    scriptBox: $('scriptBox'),
    
    // Voice
    voice1: $('voice1'),
    voice2: $('voice2'),
    badge1: $('badge1'),
    badge2: $('badge2'),
    voice2Card: $('voice2Card'),
    audition1: $('audition1'),
    audition2: $('audition2'),
    geminiVoiceSection: $('geminiVoiceSection'),
    elevenVoiceSection: $('elevenVoiceSection'),
    elevenModel: $('elevenModel'),
    elevenVoiceGrid: $('elevenVoiceGrid'),
    elevenStability: $('elevenStability'),
    elevenSimilarity: $('elevenSimilarity'),
    stabilityVal: $('stabilityVal'),
    similarityVal: $('similarityVal'),
    voiceAdjustment: $('voiceAdjustment'),
    pitchKnob: $('pitchKnob'),
    speedKnob: $('speedKnob'),
    pitchVal: $('pitchVal'),
    speedVal: $('speedVal'),
    eqPresets: $('eqPresets'),
    eqContainer: $('eqContainer'),
    ttsText: $('ttsText'),
    charCount: $('charCount'),
    synthesizeBtn: $('synthesizeBtn'),
    audioBox: $('audioBox'),
    audioPlayer: $('audioPlayer'),
    
    // History
    historyList: $('historyList'),
    recentList: $('recentList'),
    
    // Loading
    loadingOverlay: $('loadingOverlay'),
    loadingText: $('loadingText'),
    toast: $('toast')
};

// ==================== INITIALIZATION ====================
function init() {
    updateTime();
    setInterval(updateTime, 60000);
    initVoiceSelects();
    initEventListeners();
    initKnobs();
    initEqualizer();
    initElevenLabsVoiceGrid();
    loadFromStorage();
}

function updateTime() {
    const now = new Date();
    dom.statusTime.textContent = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false });
}

function initVoiceSelects() {
    [dom.voice1, dom.voice2].forEach(sel => {
        geminiVoices.forEach(v => {
            const opt = document.createElement('option');
            opt.value = v.name;
            opt.textContent = `${v.name} (${v.gender}, ${v.desc})`;
            sel.appendChild(opt);
        });
    });
    dom.voice2.value = geminiVoices[1].name;
    updateVoiceBadge(dom.voice1, dom.badge1);
    updateVoiceBadge(dom.voice2, dom.badge2);
}

function updateVoiceBadge(sel, badge) {
    const v = geminiVoices.find(x => x.name === sel.value);
    if (v) {
        badge.textContent = v.gender === 'Áî∑' ? 'Áî∑ËÅ≤' : 'Â•≥ËÅ≤';
        badge.className = v.gender === 'Áî∑' 
            ? 'text-xs px-2 py-1 rounded-full bg-cyan-500/20 text-cyan-400'
            : 'text-xs px-2 py-1 rounded-full bg-pink-500/20 text-pink-400';
    }
}

function initElevenLabsVoiceGrid() {
    dom.elevenVoiceGrid.querySelectorAll('.voice-option').forEach(opt => {
        opt.addEventListener('click', () => {
            dom.elevenVoiceGrid.querySelectorAll('.voice-option').forEach(o => o.classList.remove('selected'));
            opt.classList.add('selected');
            selectedElevenVoice = opt.dataset.voice;
        });
    });
    
    dom.elevenStability.addEventListener('input', () => {
        dom.stabilityVal.textContent = dom.elevenStability.value;
    });
    
    dom.elevenSimilarity.addEventListener('input', () => {
        dom.similarityVal.textContent = dom.elevenSimilarity.value;
    });
}

// ==================== EVENT LISTENERS ====================
function initEventListeners() {
    // File Upload
    dom.uploadArea.addEventListener('click', () => dom.fileInput.click());
    dom.fileInput.addEventListener('change', handleFileUpload);
    dom.removeFile.addEventListener('click', removeUploadedFile);
    
    dom.uploadArea.addEventListener('dragover', e => {
        e.preventDefault();
        dom.uploadArea.classList.add('dragover');
    });
    dom.uploadArea.addEventListener('dragleave', () => {
        dom.uploadArea.classList.remove('dragover');
    });
    dom.uploadArea.addEventListener('drop', e => {
        e.preventDefault();
        dom.uploadArea.classList.remove('dragover');
        if (e.dataTransfer.files.length) {
            dom.fileInput.files = e.dataTransfer.files;
            handleFileUpload({ target: dom.fileInput });
        }
    });
    
    // Process Image
    dom.processImageBtn?.addEventListener('click', processImage);
    
    // Voice Selects
    dom.voice1.addEventListener('change', () => updateVoiceBadge(dom.voice1, dom.badge1));
    dom.voice2.addEventListener('change', () => updateVoiceBadge(dom.voice2, dom.badge2));
    
    // Text Input
    dom.sourceText.addEventListener('input', checkGenerateEnabled);
    dom.ttsText.addEventListener('input', () => {
        dom.charCount.textContent = dom.ttsText.value.length;
    });
    
    // EQ Presets
    dom.eqPresets.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', () => applyEqPreset(btn.dataset.preset));
    });
}

// ==================== API CONNECTION ====================
function selectApiType(type) {
    currentApiType = type;
    
    if (type === 'gemini') {
        dom.apiTabGemini.classList.add('border-cyan-500/50', 'bg-cyan-500/10', 'text-cyan-400');
        dom.apiTabGemini.classList.remove('border-purple-500/30', 'text-gray-400');
        dom.apiTabEleven.classList.remove('border-purple-500/50', 'bg-purple-500/10', 'text-purple-400');
        dom.apiTabEleven.classList.add('border-purple-500/30', 'text-gray-400');
        dom.geminiApiSection.classList.remove('hidden');
        dom.elevenApiSection.classList.add('hidden');
    } else {
        dom.apiTabEleven.classList.add('border-purple-500/50', 'bg-purple-500/10', 'text-purple-400');
        dom.apiTabEleven.classList.remove('border-purple-500/30', 'text-gray-400');
        dom.apiTabGemini.classList.remove('border-cyan-500/50', 'bg-cyan-500/10', 'text-cyan-400');
        dom.apiTabGemini.classList.add('border-cyan-500/30', 'text-gray-400');
        dom.elevenApiSection.classList.remove('hidden');
        dom.geminiApiSection.classList.add('hidden');
    }
}

async function connectGemini() {
    geminiApiKey = dom.geminiApiKey.value.trim();
    if (!geminiApiKey) {
        showToast('Ë´ãËº∏ÂÖ• Gemini API Key', 'error');
        return;
    }
    
    showLoading('È©óË≠â Gemini API...');
    
    try {
        const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${geminiApiKey}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ contents: [{ parts: [{ text: 'Hi' }] }] })
        });
        
        if (res.ok) {
            isGeminiConnected = true;
            updateConnectionStatus();
            dom.geminiBadge.classList.remove('opacity-40');
            localStorage.setItem('gemini_api_key', geminiApiKey);
            showToast('Gemini API ÈÄ£Á∑öÊàêÂäüÔºÅ', 'success');
            enableButtons();
        } else {
            throw new Error('API È©óË≠âÂ§±Êïó');
        }
    } catch (e) {
        showToast('Gemini ÈÄ£Á∑öÂ§±Êïó: ' + e.message, 'error');
    }
    
    hideLoading();
}

async function connectElevenLabs() {
    elevenApiKey = dom.elevenApiKey.value.trim();
    if (!elevenApiKey) {
        showToast('Ë´ãËº∏ÂÖ• ElevenLabs API Key', 'error');
        return;
    }
    
    showLoading('È©óË≠â ElevenLabs API...');
    
    try {
        const res = await fetch('https://api.elevenlabs.io/v1/voices', {
            headers: { 'xi-api-key': elevenApiKey }
        });
        
        if (res.ok) {
            isElevenConnected = true;
            updateConnectionStatus();
            dom.elevenBadge.classList.remove('opacity-40');
            localStorage.setItem('eleven_api_key', elevenApiKey);
            showToast('ElevenLabs API ÈÄ£Á∑öÊàêÂäüÔºÅ', 'success');
            
            // Load available voices
            const data = await res.json();
            if (data.voices && data.voices.length > 0) {
                updateElevenVoicesFromAPI(data.voices);
            }
            
            enableButtons();
        } else {
            throw new Error('API È©óË≠âÂ§±Êïó');
        }
    } catch (e) {
        showToast('ElevenLabs ÈÄ£Á∑öÂ§±Êïó: ' + e.message, 'error');
    }
    
    hideLoading();
}

function updateElevenVoicesFromAPI(voices) {
    // Update voice grid with actual voices from API
    const grid = dom.elevenVoiceGrid;
    grid.innerHTML = '';
    
    voices.slice(0, 12).forEach((v, i) => {
        const div = document.createElement('div');
        div.className = `voice-option ${i === 0 ? 'selected' : ''}`;
        div.dataset.voice = v.voice_id;
        div.innerHTML = `
            <div class="text-sm font-semibold">${v.name}</div>
            <div class="text-xs text-gray-500">${v.labels?.accent || ''} ${v.labels?.gender || ''}</div>
        `;
        div.addEventListener('click', () => {
            grid.querySelectorAll('.voice-option').forEach(o => o.classList.remove('selected'));
            div.classList.add('selected');
            selectedElevenVoice = v.voice_id;
        });
        grid.appendChild(div);
    });
    
    if (voices.length > 0) {
        selectedElevenVoice = voices[0].voice_id;
    }
}

function updateConnectionStatus() {
    const connected = isGeminiConnected || isElevenConnected;
    dom.connDot.classList.toggle('on', connected);
    dom.connDot.classList.toggle('off', !connected);
    
    if (isGeminiConnected && isElevenConnected) {
        dom.connText.textContent = 'ÈõôÂºïÊìé';
    } else if (isGeminiConnected) {
        dom.connText.textContent = 'Gemini';
    } else if (isElevenConnected) {
        dom.connText.textContent = 'ElevenLabs';
    } else {
        dom.connText.textContent = 'Èõ¢Á∑ö';
    }
}

function enableButtons() {
    dom.generateBtn.disabled = !(isGeminiConnected && (uploadedContent || dom.sourceText.value.trim()));
    dom.audition1.disabled = !isGeminiConnected;
    dom.audition2.disabled = !isGeminiConnected;
    dom.synthesizeBtn.disabled = !(isGeminiConnected || isElevenConnected);
    
    // Enable ElevenLabs audition button
    const auditionEleven = document.getElementById('auditionEleven');
    if (auditionEleven) {
        auditionEleven.disabled = !isElevenConnected;
    }
}

function checkGenerateEnabled() {
    dom.generateBtn.disabled = !(isGeminiConnected && (uploadedContent || dom.sourceText.value.trim()));
}

// ==================== PAGE NAVIGATION ====================
function switchPage(page) {
    document.querySelectorAll('.tab-item').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.page === page);
    });
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    $(page + 'Page').classList.add('active');
    
    const titles = { home: 'AI PODCAST', create: 'CREATE SCRIPT', voice: 'VOICE SYNTHESIS', history: 'HISTORY', settings: 'SETTINGS' };
    $('navTitle').textContent = titles[page] || 'AI PODCAST';
}

// ==================== FILE HANDLING ====================
async function handleFileUpload(e) {
    const file = e.target.files[0];
    if (!file) return;
    
    showLoading('ËôïÁêÜÊ™îÊ°à‰∏≠...');
    
    try {
        if (file.type === 'application/pdf') {
            uploadedContent = await extractPdfText(file);
            dom.sourceText.value = uploadedContent;
        } else if (file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            await new Promise((resolve, reject) => {
                reader.onload = e => {
                    uploadedImageData = e.target.result.split(',')[1];
                    dom.imageOptions.classList.remove('hidden');
                    resolve();
                };
                reader.onerror = reject;
            });
        } else {
            uploadedContent = await file.text();
            dom.sourceText.value = uploadedContent;
        }
        
        dom.fileName.textContent = file.name;
        dom.fileStatus.classList.remove('hidden');
        checkGenerateEnabled();
        showToast('Ê™îÊ°à‰∏äÂÇ≥ÊàêÂäü', 'success');
    } catch (e) {
        showToast('Ê™îÊ°àËôïÁêÜÂ§±Êïó: ' + e.message, 'error');
    }
    
    hideLoading();
}

async function extractPdfText(file) {
    const data = await file.arrayBuffer();
    const pdf = await pdfjsLib.getDocument({ data }).promise;
    let text = '';
    for (let i = 1; i <= pdf.numPages; i++) {
        const page = await pdf.getPage(i);
        const content = await page.getTextContent();
        text += content.items.map(x => x.str).join(' ') + '\n';
    }
    return text;
}

function removeUploadedFile() {
    uploadedContent = null;
    uploadedImageData = null;
    dom.fileInput.value = '';
    dom.fileStatus.classList.add('hidden');
    dom.imageOptions.classList.add('hidden');
    checkGenerateEnabled();
}

async function processImage() {
    if (!isGeminiConnected || !uploadedImageData) {
        showToast('Ë´ãÂÖàÈÄ£Á∑ö API ‰∏¶‰∏äÂÇ≥ÂúñÁâá', 'error');
        return;
    }
    
    showLoading('ËôïÁêÜÂúñÂÉè‰∏≠...');
    
    const mode = document.querySelector('input[name="imageMode"]:checked').value;
    const targetLang = dom.targetLang.value;
    
    let prompt;
    if (mode === 'ocr') {
        prompt = targetLang === 'zh-TW' 
            ? "Ë´ãÁ≤æÁ¢∫Âú∞ÊèêÂèñÈÄôÂºµÂúñÁâá‰∏≠ÁöÑÊâÄÊúâÊñáÂ≠ó„ÄÇÂ¶ÇÊûúÂúñÁâá‰∏≠Ê≤íÊúâÊñáÂ≠ó,Ë´ãÂõûË¶Ü„ÄéÂúñÁâá‰∏≠Êú™ÂÅµÊ∏¨Âà∞ÊñáÂ≠ó„Äè„ÄÇË´ã‰ΩøÁî®ÁπÅÈ´î‰∏≠ÊñáÂõûÁ≠î„ÄÇ"
            : "Please accurately extract all text from this image. If there is no text, reply 'No text detected'.";
    } else {
        prompt = targetLang === 'zh-TW'
            ? "Ë´ãË©≥Á¥∞ÊèèËø∞ÈÄôÂºµÂúñÁâáÁöÑÂ†¥ÊôØ„ÄÅÁâ©È´î„ÄÅÊ∞õÂúçÂíåÂèØËÉΩÁöÑÊÑèÂ¢É„ÄÇË´ãÁî®ÂØåÊúâÊÑüÊüìÂäõÁöÑË™ûË®Ä,ÁîüÊàê‰∏ÄÊÆµÈÅ©ÂêàÁî®Êñº Podcast ÈñãÂ†¥ÊàñÊïÖ‰∫ãÈùàÊÑüÁöÑÊñáÂ≠ó„ÄÇË´ãÁî®ÁπÅÈ´î‰∏≠ÊñáÂõûÁ≠î„ÄÇ"
            : "Please describe in detail the scene, objects, atmosphere and mood of this image. Generate text suitable for a Podcast opening.";
    }
    
    try {
        const result = await callGeminiVision(prompt, uploadedImageData);
        dom.sourceText.value = result;
        uploadedContent = result;
        dom.imageOptions.classList.add('hidden');
        checkGenerateEnabled();
        showToast('ÂúñÂÉèËôïÁêÜÂÆåÊàê', 'success');
    } catch (e) {
        showToast('ÂúñÂÉèËôïÁêÜÂ§±Êïó: ' + e.message, 'error');
    }
    
    hideLoading();
}

async function callGeminiVision(prompt, imageData) {
    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${geminiApiKey}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            contents: [{
                parts: [
                    { text: prompt },
                    { inline_data: { mime_type: 'image/jpeg', data: imageData } }
                ]
            }]
        })
    });
    
    if (!res.ok) throw new Error(`API Error: ${res.status}`);
    const data = await res.json();
    return data.candidates?.[0]?.content?.parts?.[0]?.text || '';
}

// ==================== SCRIPT GENERATION ====================
function setScriptMode(mode) {
    scriptMode = mode;
    document.querySelectorAll('[data-mode]').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.mode === mode);
        btn.classList.toggle('text-gray-500', btn.dataset.mode !== mode);
    });
    dom.speaker2Box.classList.toggle('hidden', mode !== 'dual');
}

async function generateScript() {
    const source = uploadedContent || dom.sourceText.value.trim();
    if (!source || !isGeminiConnected) {
        showToast('Ë´ãÊèê‰æõË≥áÊñô‰æÜÊ∫ê‰∏¶ÈÄ£Á∑ö API', 'error');
        return;
    }
    
    showLoading('AI Ê≠£Âú®ÁîüÊàêËÖ≥Êú¨...');
    
    try {
        // Generate summary first
        const summaryPrompt = `Ë´ãÂ∞á‰ª•‰∏ãÊñáÁ´†ÂÖßÂÆπ,ÊøÉÁ∏ÆÊàê‰∏Ä‰ªΩÁ¥Ñ 500 Â≠óÁöÑÊëòË¶Å,‰øùÁïôÂÖ∂Ê†∏ÂøÉËßÄÈªûËàáÈóúÈçµË≥áË®ä„ÄÇË´ã‰ΩøÁî®ÁπÅÈ´î‰∏≠ÊñáÊí∞ÂØ´ÊëòË¶Å„ÄÇ\n\n---\n${source}`;
        const summary = await callGeminiAPI(summaryPrompt);
        
        // Build script prompt
        const config = {
            mode: scriptMode,
            wordCount: dom.wordCount.value,
            scriptStyle: dom.scriptStyle.value,
            discussionTopic: dom.topic.value.trim(),
            speaker1Name: dom.speaker1Name.value.trim() || '‰∏ªÊåÅ‰∫∫',
            speaker1Intro: dom.speaker1Intro.value.trim(),
            speaker2Name: dom.speaker2Name.value.trim() || '‰æÜË≥ì',
            speaker2Intro: dom.speaker2Intro.value.trim()
        };
        
        const scriptPrompt = buildScriptPrompt(summary, config);
        generatedScript = await callGeminiAPI(scriptPrompt);
        
        // Generate titles
        const titlePrompt = `Ë´ãÊ†πÊìö‰ª•‰∏ã Podcast ËÖ≥Êú¨,ÁÇ∫ÊàëÁîüÊàê 3 ÂÄãÂê∏Âºï‰∫∫ÁöÑ Podcast Ê®ôÈ°åÔºàÊØèÂâáÊ®ôÈ°å 20 Â≠ó‰ª•ÂÖßÔºâ„ÄÇË´ã‰ΩøÁî®ÁπÅÈ´î‰∏≠Êñá„ÄÇ\n\nËÖ≥Êú¨Ôºö\n${generatedScript.substring(0, 2000)}\n\nË´ãÊåâÁÖß‰ª•‰∏ãÊ†ºÂºèÂõûË¶ÜÔºö\n„ÄêÊ®ôÈ°å1„ÄëÔºàÁ¨¨‰∏ÄÂÄãÊ®ôÈ°åÔºâ\n„ÄêÊ®ôÈ°å2„ÄëÔºàÁ¨¨‰∫åÂÄãÊ®ôÈ°åÔºâ\n„ÄêÊ®ôÈ°å3„ÄëÔºàÁ¨¨‰∏âÂÄãÊ®ôÈ°åÔºâ`;
        const titleResult = await callGeminiAPI(titlePrompt);
        generatedTitles = parseTitles(titleResult);
        
        // Generate show notes
        const notesPrompt = `Ë´ãÊ†πÊìö‰ª•‰∏ã Podcast ËÖ≥Êú¨,ÁîüÊàê‰∏ÄÊÆµÁØÄÁõÆÊëòË¶Å (Show Notes)„ÄÇÊëòË¶ÅÊáâË©≤Á∞°ÊΩîÂú∞Á∏ΩÁµêÁØÄÁõÆÁöÑ‰∏ªË¶ÅÂÖßÂÆπ„ÄÅË®éË´ñÁöÑÈáçÈªû,‰∏¶Âê∏ÂºïËÅΩÁúæ„ÄÇÁ¥Ñ 200-300 Â≠ó,‰ΩøÁî®ÁπÅÈ´î‰∏≠Êñá„ÄÇ\n\nËÖ≥Êú¨Ôºö\n${generatedScript.substring(0, 3000)}`;
        generatedSummary = await callGeminiAPI(notesPrompt);
        
        // Display results
        displayGeneratedContent();
        showToast('ËÖ≥Êú¨ÁîüÊàêÊàêÂäüÔºÅ', 'success');
    } catch (e) {
        showToast('ÁîüÊàêÂ§±Êïó: ' + e.message, 'error');
    }
    
    hideLoading();
}

function buildScriptPrompt(summary, config) {
    let styleInstruction;
    switch (config.scriptStyle) {
        case 'storybook':
            styleInstruction = "Ë´ãÁî®ÁîüÂãï„ÄÅÊ¥ªÊΩë„ÄÅÂØåÊúâÊÉ≥ÂÉèÂäõÁöÑË™ûË®Ä,ÂÉèÊòØÂú®Ë¨õÁ´•Ë©±ÊïÖ‰∫ã‰∏ÄÊ®£„ÄÇÂ§ö‰ΩøÁî®ÁãÄËÅ≤Ë©ûÂíåË™áÂºµÁöÑË™ûÊ∞£„ÄÇ";
            break;
        case 'report':
            styleInstruction = "Ë´ã‰ΩøÁî®Á≤æÁ¢∫„ÄÅÂ∞àÊ•≠„ÄÅÂÆ¢ËßÄÁöÑÂïÜÊ•≠Ë°ìË™û„ÄÇÁµêÊßãÊ∏ÖÊô∞,ÈÇèËºØÂö¥Ë¨π,È¢®Ê†ºÊ≠£Âºè,ÈÅ©ÂêàÁî®ÊñºÁèæ‰ª£ÂïÜÂãôÂ†±Âëä„ÄÇ";
            break;
        case 'chat':
            styleInstruction = "Ë´ã‰ΩøÁî®ÈùûÂ∏∏Âè£Ë™ûÂåñ„ÄÅËºïÈ¨Ü„ÄÅËá™ÁÑ∂ÁöÑËÅäÂ§©È¢®Ê†º„ÄÇÂèØ‰ª•ÂåÖÂê´‰∏Ä‰∫õÈùûÊ≠£ÂºèÁî®Ë™û„ÄÅË™ûÂä©Ë©û,Â∞±ÂÉèÊúãÂèãÂú®ËÅäÂ§©‰∏ÄÊ®£„ÄÇ";
            break;
        case 'product':
            styleInstruction = "Ë´ã‰ΩøÁî®ÊúâË™™ÊúçÂäõ„ÄÅÁÜ±ÊÉÖ‰∏îÊ∏ÖÊô∞ÁöÑË™ûË®Ä„ÄÇÈáçÈªûÁ™ÅÂá∫Áî¢ÂìÅÁöÑÁâπËâ≤„ÄÅÂÑ™Âã¢ÂíåÂ∏∂Áµ¶ÂÆ¢Êà∂ÁöÑÂ•ΩËôï„ÄÇ";
            break;
        case 'announcement':
            styleInstruction = "Ë´ã‰ΩøÁî®Ê≠£Âºè„ÄÅÊ¨äÂ®Å„ÄÅÊ∏ÖÊô∞ÁöÑË™ûË®Ä„ÄÇË™ûÊ∞£ËéäÈáç‰ΩÜË¶™Âàá,ÈáçÈªûÁ™ÅÂá∫ÊîøÁ≠ñÂÖßÂÆπ„ÄÅÂØ¶ÊñΩÁ¥∞ÁØÄÂíåÊ∞ëÁúæÊ¨äÁõä„ÄÇ";
            break;
        case 'bazi':
            styleInstruction = "‰Ω†ÊòØ‰∏Ä‰ΩçÂ∞àÊ•≠ÁöÑÂëΩÁêÜËß£ÊûêÂ∞àÂÆ∂,ÊìÖÈï∑ÂÖ´Â≠óÂëΩÁõ§ÂàÜÊûê„ÄÇË´ã‰ΩøÁî®Â∞àÊ•≠‰ΩÜÊòìÊáÇÁöÑË™ûË®Ä,ÁµêÂêàÂÇ≥Áµ±ÂëΩÁêÜÂ≠∏Áü•Ë≠òËàáÁèæ‰ª£Ë©ÆÈáã„ÄÇ";
            break;
        default:
            styleInstruction = "Ë´ã‰ΩøÁî®Á∞°ÂñÆÊòéÁû≠„ÄÅËá™ÁÑ∂Âè£Ë™ûÁöÑË™ûË®Ä,ÈÅøÂÖçÈÅéÂ∫¶Â∞àÊ•≠ÁöÑË°ìË™û„ÄÇÂÖßÂÆπÈÇèËºØÊµÅÊö¢,ÈÅ©ÊôÇ‰ΩøÁî®ÈÅéÊ∏°Ë©û„ÄÇ";
    }
    
    let openingRule = config.mode === 'single'
        ? `ÈñãÈ†≠ÂøÖÈ†àÊòØ„ÄåÊ≠°ËøéÊî∂ËÅΩ,ÊàëÊòØ${config.speaker1Name},‚Ä¶‚Ä¶„Äç`
        : `ÈñãÈ†≠ÂøÖÈ†àÊòØ„ÄåSpeaker 1: Ê≠°ËøéÊî∂ËÅΩ,ÊàëÊòØ ${config.speaker1Name},‚Ä¶‚Ä¶„Äç`;
    
    let formatRule = config.mode === 'single'
        ? `ÊÆµËêΩÊúÄÂâçÈù¢‰∏çÈúÄË¶ÅÂä†‰∏äÂßìÂêçÊàñÂÜíËôü„ÄÇ`
        : `ÊØè‰∏ÄË°åÈÉΩÂøÖÈ†à‰ª•„ÄåSpeaker 1:„ÄçÊàñ„ÄåSpeaker 2:„ÄçÈñãÈ†≠„ÄÇ`;
    
    let topicInstruction = config.discussionTopic 
        ? `\n6. **Ë®éË´ñ‰∏ªÈ°å**: Ë´ã‰ª•„Äå${config.discussionTopic}„ÄçÁÇ∫Ê†∏ÂøÉ‰∏ªÈ°åÂ±ïÈñãË®éË´ñ`
        : '';
    
    return `‰Ω†ÊòØÂ∞àÊ•≠ÁöÑ Podcast ËÖ≥Êú¨Êí∞ÂØ´Â∞àÂÆ∂„ÄÇË´ãÂö¥Ê†ºÊ†πÊìö‰ª•‰∏ãË¶èÂâáÊí∞ÂØ´ Podcast ËÖ≥Êú¨„ÄÇ

### ËÖ≥Êú¨È¢®Ê†ºË¶ÅÊ±Ç ###
${styleInstruction}

### ËÖ≥Êú¨Ë¶èÂâá ###
1. **ÈñãÈ†≠**: ${openingRule}
2. **Ê†ºÂºè**: ${formatRule}
3. **Â≠óÊï∏**: Á∏ΩÂ≠óÊï∏Á¥Ñ ${config.wordCount} Â≠ó
4. **Ë™ûË®Ä**: ÁπÅÈ´î‰∏≠Êñá
5. **Á¥îÊñáÂ≠ó**: ‰∏çË¶Å‰ΩøÁî®‰ªª‰ΩïÊ®ôË®òÁ¨¶ËôüÂ¶Ç * Êàñ #${topicInstruction}

### ËÖ≥Êú¨Ë®≠ÂÆö ###
- Ê®°Âºè: ${config.mode === 'single' ? 'ÂñÆ‰∫∫' : 'Èõô‰∫∫'}
- Ë¨õËÄÖ: ${config.speaker1Name}${config.mode === 'dual' ? `„ÄÅ${config.speaker2Name}` : ''}

### Ê†∏ÂøÉÊëòË¶Å ###
${summary}

Ë´ãÁõ¥Êé•Ëº∏Âá∫ËÖ≥Êú¨ÂÖßÂÆπ:`;
}

function parseTitles(text) {
    const titles = [];
    const regex = /„ÄêÊ®ôÈ°å\d+„Äë\s*([\s\S]*?)(?=„ÄêÊ®ôÈ°å\d+„Äë|$)/g;
    let m;
    while ((m = regex.exec(text)) !== null) {
        const t = m[1].trim();
        if (t) titles.push(t);
    }
    if (titles.length === 0) {
        const lines = text.split('\n').filter(l => l.trim());
        for (let i = 0; i < Math.min(3, lines.length); i++) {
            titles.push(lines[i].replace(/^[„Äê\[\]„Äë\d+„ÄÅ.:]+/, '').trim());
        }
    }
    return titles;
}

function displayGeneratedContent() {
    dom.resultBox.classList.remove('hidden');
    
    // Titles
    dom.titlesBox.innerHTML = generatedTitles.map((t, i) => `
        <div class="title-item p-3" onclick="copyText(null, '${t.replace(/'/g, "\\'")}')">
            <div class="flex items-center gap-2">
                <span class="w-6 h-6 rounded-full bg-cyan-500/20 text-cyan-400 flex items-center justify-center text-xs font-bold">${i + 1}</span>
                <span class="text-sm">${t}</span>
            </div>
        </div>
    `).join('');
    
    // Summary & Script
    dom.summaryBox.textContent = generatedSummary;
    dom.scriptBox.textContent = generatedScript;
    dom.ttsText.value = generatedScript;
    dom.charCount.textContent = generatedScript.length;
}

async function callGeminiAPI(prompt) {
    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${geminiApiKey}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
    });
    
    if (!res.ok) throw new Error(`API Error: ${res.status}`);
    const data = await res.json();
    return data.candidates?.[0]?.content?.parts?.[0]?.text || '';
}

// ==================== TTS ENGINE ====================
function setTTSEngine(engine) {
    currentTTSEngine = engine;
    document.querySelectorAll('[data-engine]').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.engine === engine);
        btn.classList.toggle('text-gray-500', btn.dataset.engine !== engine);
    });
    
    dom.geminiVoiceSection.classList.toggle('hidden', engine !== 'gemini');
    dom.elevenVoiceSection.classList.toggle('hidden', engine !== 'elevenlabs');
    dom.voiceAdjustment.classList.toggle('hidden', engine !== 'gemini');
}

function setVoiceMode(mode) {
    voiceMode = mode;
    document.querySelectorAll('[data-vmode]').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.vmode === mode);
        btn.classList.toggle('text-gray-500', btn.dataset.vmode !== mode);
    });
    dom.voice2Card.classList.toggle('hidden', mode !== 'dual');
}

// ==================== QUICK TEST FUNCTIONS ====================
async function quickTestVoice() {
    if (!isGeminiConnected && !isElevenConnected) {
        showToast('Ë´ãÂÖàÈÄ£Á∑ö API', 'error');
        return;
    }
    
    const testText = 'ÈÄôÊòØ‰∏ÄÊÆµË™ûÈü≥Ê∏¨Ë©¶ÔºåÁî®‰æÜÁ¢∫Ë™çË™ûÈü≥ÊïàÊûúÂíåÈü≥Ë≥™„ÄÇHello, this is a voice test.';
    showLoading('‚ö° Âø´ÈÄüÊ∏¨Ë©¶‰∏≠...', 50);
    
    try {
        let audioBlob;
        if (currentTTSEngine === 'elevenlabs' && isElevenConnected) {
            audioBlob = await generateElevenLabsTTS(testText);
        } else if (isGeminiConnected) {
            audioBlob = await generateGeminiTTS(testText, dom.voice1.value);
        }
        
        const url = URL.createObjectURL(audioBlob);
        const audio = new Audio(url);
        audio.play();
        showToast('üîä Êí≠ÊîæÊ∏¨Ë©¶Èü≥Ê™î', 'success');
    } catch (e) {
        showToast('Ê∏¨Ë©¶Â§±Êïó: ' + e.message, 'error');
    }
    
    hideLoading();
}

async function auditionElevenLabsVoice() {
    if (!isElevenConnected) {
        showToast('Ë´ãÂÖàÈÄ£Á∑ö ElevenLabs API', 'error');
        return;
    }
    
    // Get selected voice name for display
    const selectedOption = dom.elevenVoiceGrid.querySelector('.voice-option.selected');
    const voiceName = selectedOption ? selectedOption.querySelector('.text-sm').textContent : 'ElevenLabs';
    
    showLoading(`üéß Ë©¶ËÅΩ ${voiceName} Ë™ûÈü≥...`, 50);
    
    const testText = 'Â§ßÂÆ∂Â•ΩÔºåÊ≠°ËøéÊî∂ËÅΩÊàëÂÄëÁöÑÁØÄÁõÆÔºÅ‰ªäÂ§©ÁöÑÂÖßÂÆπÈùûÂ∏∏Á≤æÂΩ©ÔºåË´ãÁπºÁ∫åÊî∂ËÅΩ„ÄÇHello everyone, welcome to our show!';
    
    try {
        const audioBlob = await generateElevenLabsTTS(testText);
        const url = URL.createObjectURL(audioBlob);
        const audio = new Audio(url);
        audio.play();
        showToast(`üîä Êí≠Êîæ ${voiceName} Ë™ûÈü≥`, 'success');
    } catch (e) {
        showToast('Ë©¶ËÅΩÂ§±Êïó: ' + e.message, 'error');
    }
    
    hideLoading();
}

async function synthesizeFirstParagraph() {
    const fullText = dom.ttsText.value.trim();
    if (!fullText) {
        showToast('Ë´ãËº∏ÂÖ•ÊñáÂ≠ó', 'error');
        return;
    }
    
    if (!isGeminiConnected && !isElevenConnected) {
        showToast('Ë´ãÂÖàÈÄ£Á∑ö API', 'error');
        return;
    }
    
    // Get first 500 characters or first paragraph
    let shortText = fullText.substring(0, 500);
    const paragraphEnd = shortText.lastIndexOf('„ÄÇ');
    if (paragraphEnd > 100) {
        shortText = shortText.substring(0, paragraphEnd + 1);
    }
    
    showLoading(`‚ö° Âø´ÈÄüÁîüÊàêÂâç ${shortText.length} Â≠ó...`, 30);
    
    const startTime = Date.now();
    
    try {
        let audioBlob;
        if (currentTTSEngine === 'elevenlabs' && isElevenConnected) {
            audioBlob = await generateElevenLabsTTS(shortText);
        } else if (isGeminiConnected) {
            audioBlob = await generateGeminiTTS(shortText, dom.voice1.value);
        }
        
        const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
        
        currentAudioUrl = URL.createObjectURL(audioBlob);
        dom.audioPlayer.src = currentAudioUrl;
        dom.audioBox.classList.remove('hidden');
        
        addToHistory({
            text: shortText.substring(0, 50) + '... (Âø´ÈÄü)',
            url: currentAudioUrl,
            engine: currentTTSEngine
        });
        
        showToast(`‚ö° Âø´ÈÄüÁîüÊàêÂÆåÊàêÔºÅ${shortText.length}Â≠ó / ${elapsed}Áßí`, 'success');
    } catch (e) {
        showToast('ÁîüÊàêÂ§±Êïó: ' + e.message, 'error');
    }
    
    hideLoading();
}

// ==================== VOICE SYNTHESIS ====================
async function auditionVoice(num) {
    if (!isGeminiConnected) {
        showToast('Ë´ãÂÖàÈÄ£Á∑ö Gemini API', 'error');
        return;
    }
    
    showLoading('ÁîüÊàêË©¶ËÅΩÈü≥Ê™î...');
    
    const voiceName = num === 1 ? dom.voice1.value : dom.voice2.value;
    const text = 'Â§ßÂÆ∂Â•ΩÔºåÊ≠°ËøéÊî∂ËÅΩÊàëÂÄëÁöÑÁØÄÁõÆÔºå‰ªäÂ§©ÁöÑÂÖßÂÆπÈùûÂ∏∏Á≤æÂΩ©ÔºÅ';
    
    try {
        const audioBlob = await generateGeminiTTS(text, voiceName);
        const url = URL.createObjectURL(audioBlob);
        new Audio(url).play();
        showToast('Êí≠Êîæ‰∏≠...', 'success');
    } catch (e) {
        showToast('Ë©¶ËÅΩÂ§±Êïó: ' + e.message, 'error');
    }
    
    hideLoading();
}

async function synthesizeVoice() {
    const text = dom.ttsText.value.trim();
    if (!text) {
        showToast('Ë´ãËº∏ÂÖ•ÊñáÂ≠ó', 'error');
        return;
    }
    
    if (currentTTSEngine === 'gemini' && !isGeminiConnected) {
        showToast('Ë´ãÂÖàÈÄ£Á∑ö Gemini API', 'error');
        return;
    }
    
    if (currentTTSEngine === 'elevenlabs' && !isElevenConnected) {
        showToast('Ë´ãÂÖàÈÄ£Á∑ö ElevenLabs API', 'error');
        return;
    }
    
    const startTime = Date.now();
    showLoading('Ê∫ñÂÇôÁîüÊàêË™ûÈü≥...');
    
    try {
        let audioBlob;
        
        if (currentTTSEngine === 'elevenlabs') {
            // ElevenLabs - ÂàÜÂ°äËôïÁêÜÈï∑ÊñáÊú¨
            if (text.length > 2500) {
                const chunks = splitTextIntoChunks(text, 2500);
                const blobs = [];
                
                for (let i = 0; i < chunks.length; i++) {
                    const progress = Math.round((i / chunks.length) * 100);
                    dom.loadingText.textContent = `üîä ElevenLabs ÁîüÊàê‰∏≠ ${i + 1}/${chunks.length} (${progress}%)`;
                    const blob = await generateElevenLabsTTS(chunks[i]);
                    blobs.push(blob);
                }
                
                audioBlob = new Blob(blobs, { type: 'audio/mpeg' });
            } else {
                dom.loadingText.textContent = 'üîä ElevenLabs ÁîüÊàê‰∏≠...';
                audioBlob = await generateElevenLabsTTS(text);
            }
        } else {
            // Gemini TTS - ÂÑ™ÂåñÂàÜÂ°äÂ§ßÂ∞è
            const chunkSize = text.length > 3000 ? 1500 : 2000; // ËºÉÂ∞èÂ°äÊõ¥Âø´
            const chunks = splitTextIntoChunks(text, chunkSize);
            const totalChunks = chunks.length;
            
            if (totalChunks === 1) {
                dom.loadingText.textContent = 'üéôÔ∏è Gemini Ë™ûÈü≥ÁîüÊàê‰∏≠...';
                audioBlob = await generateGeminiTTS(chunks[0], dom.voice1.value);
            } else {
                // ‰∏¶Ë°åËôïÁêÜ (ÊúÄÂ§öÂêåÊôÇ 2 ÂÄãË´ãÊ±ÇÔºåÈÅøÂÖç API ÈôêÂà∂)
                const blobs = new Array(totalChunks);
                const concurrency = 2;
                
                for (let i = 0; i < totalChunks; i += concurrency) {
                    const batch = chunks.slice(i, Math.min(i + concurrency, totalChunks));
                    const progress = Math.round((i / totalChunks) * 100);
                    dom.loadingText.textContent = `üéôÔ∏è ÁîüÊàê‰∏≠ ${i + 1}-${Math.min(i + concurrency, totalChunks)}/${totalChunks} (${progress}%)`;
                    
                    const results = await Promise.all(
                        batch.map((chunk, idx) => generateGeminiTTS(chunk, dom.voice1.value))
                    );
                    
                    results.forEach((blob, idx) => {
                        blobs[i + idx] = blob;
                    });
                }
                
                audioBlob = new Blob(blobs.filter(b => b), { type: 'audio/wav' });
            }
        }
        
        const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
        
        currentAudioUrl = URL.createObjectURL(audioBlob);
        dom.audioPlayer.src = currentAudioUrl;
        dom.audioBox.classList.remove('hidden');
        
        // Add to history
        addToHistory({
            text: text.substring(0, 50) + '...',
            url: currentAudioUrl,
            engine: currentTTSEngine
        });
        
        showToast(`‚úÖ Ë™ûÈü≥ÁîüÊàêÂÆåÊàêÔºÅËÄóÊôÇ ${elapsed} Áßí`, 'success');
    } catch (e) {
        showToast('Ë™ûÈü≥ÁîüÊàêÂ§±Êïó: ' + e.message, 'error');
    }
    
    hideLoading();
}

async function generateGeminiTTS(text, voiceName) {
    let prompt = text;
    let modifiers = [];
    
    if (speed <= 0.7) modifiers.push('ÈùûÂ∏∏ÊÖ¢');
    else if (speed <= 0.9) modifiers.push('ÊÖ¢ÈÄü');
    if (speed >= 1.4) modifiers.push('ÈùûÂ∏∏Âø´');
    else if (speed >= 1.2) modifiers.push('Âø´ÈÄü');
    
    if (pitch <= -6) modifiers.push('ÈùûÂ∏∏‰ΩéÊ≤âÁöÑ');
    else if (pitch <= -3) modifiers.push('‰ΩéÊ≤âÁöÑ');
    if (pitch >= 6) modifiers.push('ÈùûÂ∏∏È´ò‰∫¢ÁöÑ');
    else if (pitch >= 3) modifiers.push('È´ò‰∫¢ÁöÑ');
    
    if (modifiers.length > 0) {
        prompt = `Áî®${modifiers.join('„ÄÅ')}ËÅ≤Èü≥Ë™™: ${text}`;
    }
    
    const speechConfig = voiceMode === 'dual' ? {
        multiSpeakerVoiceConfig: {
            speakerVoiceConfigs: [
                { speaker: "Speaker 1", voiceConfig: { prebuiltVoiceConfig: { voiceName: dom.voice1.value } } },
                { speaker: "Speaker 2", voiceConfig: { prebuiltVoiceConfig: { voiceName: dom.voice2.value } } }
            ]
        }
    } : {
        voiceConfig: { prebuiltVoiceConfig: { voiceName } }
    };
    
    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${geminiApiKey}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            contents: [{ parts: [{ text: prompt }] }],
            generationConfig: { responseModalities: ["AUDIO"], speechConfig }
        })
    });
    
    if (!res.ok) throw new Error(`TTS API Error: ${res.status}`);
    
    const data = await res.json();
    const audioData = data?.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;
    const mimeType = data?.candidates?.[0]?.content?.parts?.[0]?.inlineData?.mimeType;
    
    if (!audioData) throw new Error('Êú™Êî∂Âà∞Èü≥Ë®äÊï∏Êìö');
    
    const sampleRate = parseInt(mimeType?.match(/rate=(\d+)/)?.[1] || "24000", 10);
    const pcmData = base64ToArrayBuffer(audioData);
    const pcm16 = new Int16Array(pcmData);
    
    return pcmToWav(pcm16, sampleRate);
}

async function generateElevenLabsTTS(text) {
    const stability = dom.elevenStability.value / 100;
    const similarity = dom.elevenSimilarity.value / 100;
    const model = dom.elevenModel.value;
    
    // ÂòóË©¶‰ΩøÁî® CORS ‰ª£ÁêÜ
    const directUrl = `https://api.elevenlabs.io/v1/text-to-speech/${selectedElevenVoice}`;
    
    // ÂòóË©¶Â§öÂÄãÊñπÊ°à
    const urls = [
        directUrl,
        `https://corsproxy.io/?${encodeURIComponent(directUrl)}`,
        `https://api.allorigins.win/raw?url=${encodeURIComponent(directUrl)}`
    ];
    
    let lastError = null;
    
    for (const url of urls) {
        try {
            const isProxy = url !== directUrl;
            
            const res = await fetch(url, {
                method: 'POST',
                headers: {
                    'xi-api-key': elevenApiKey,
                    'Content-Type': 'application/json',
                    'Accept': 'audio/mpeg'
                },
                body: JSON.stringify({
                    text: text,
                    model_id: model,
                    voice_settings: {
                        stability: stability,
                        similarity_boost: similarity
                    }
                })
            });
            
            if (res.ok) {
                const blob = await res.blob();
                if (blob.size > 0) {
                    if (isProxy) {
                        console.log('ElevenLabs: ‰ΩøÁî®‰ª£ÁêÜÊàêÂäü');
                    }
                    return blob;
                }
            }
            
            // ÂòóË©¶ËÆÄÂèñÈåØË™§Ë®äÊÅØ
            try {
                const err = await res.clone().json();
                lastError = err.detail?.message || err.detail || `HTTP ${res.status}`;
            } catch (e) {
                lastError = `HTTP ${res.status}`;
            }
        } catch (e) {
            lastError = e.message;
            console.log(`ElevenLabs ÂòóË©¶Â§±Êïó (${url.substring(0, 50)}...): ${e.message}`);
        }
    }
    
    // ÊâÄÊúâÊñπÊ°àÈÉΩÂ§±Êïó
    if (lastError === 'Failed to fetch' || lastError === 'Load failed') {
        throw new Error('ElevenLabs ÁÑ°Ê≥ïÂæûÁÄèË¶ΩÂô®Áõ¥Êé•Â≠òÂèñ (CORS ÈôêÂà∂)„ÄÇ\n\nËß£Ê±∫ÊñπÊ°àÔºö\n1. ÊîπÁî® Gemini TTSÔºàÊé®Ëñ¶Ôºâ\n2. Â∞áÊ≠§È†ÅÈù¢ÈÉ®ÁΩ≤Âà∞‰º∫ÊúçÂô®');
    }
    
    throw new Error(`ElevenLabs: ${lastError}`);
}

function splitTextIntoChunks(text, maxLen) {
    const chunks = [];
    let remaining = text;
    
    while (remaining.length > 0) {
        if (remaining.length <= maxLen) {
            chunks.push(remaining);
            break;
        }
        
        let idx = remaining.lastIndexOf('„ÄÇ', maxLen);
        if (idx === -1) idx = remaining.lastIndexOf('Ôºå', maxLen);
        if (idx === -1) idx = remaining.lastIndexOf(' ', maxLen);
        if (idx === -1) idx = maxLen;
        
        chunks.push(remaining.substring(0, idx + 1));
        remaining = remaining.substring(idx + 1);
    }
    
    return chunks;
}

function base64ToArrayBuffer(base64) {
    const binaryString = atob(base64);
    const bytes = new Uint8Array(binaryString.length);
    for (let i = 0; i < binaryString.length; i++) {
        bytes[i] = binaryString.charCodeAt(i);
    }
    return bytes.buffer;
}

function pcmToWav(pcm16, sampleRate) {
    const numChannels = 1;
    const bytesPerSample = 2;
    const blockAlign = numChannels * bytesPerSample;
    const byteRate = sampleRate * blockAlign;
    const dataSize = pcm16.length * bytesPerSample;
    const buffer = new ArrayBuffer(44 + dataSize);
    const view = new DataView(buffer);
    
    // WAV header
    writeString(view, 0, 'RIFF');
    view.setUint32(4, 36 + dataSize, true);
    writeString(view, 8, 'WAVE');
    writeString(view, 12, 'fmt ');
    view.setUint32(16, 16, true);
    view.setUint16(20, 1, true);
    view.setUint16(22, numChannels, true);
    view.setUint32(24, sampleRate, true);
    view.setUint32(28, byteRate, true);
    view.setUint16(32, blockAlign, true);
    view.setUint16(34, bytesPerSample * 8, true);
    writeString(view, 36, 'data');
    view.setUint32(40, dataSize, true);
    
    // PCM data
    const output = new Int16Array(buffer, 44);
    output.set(pcm16);
    
    return new Blob([buffer], { type: 'audio/wav' });
}

function writeString(view, offset, str) {
    for (let i = 0; i < str.length; i++) {
        view.setUint8(offset + i, str.charCodeAt(i));
    }
}

// ==================== KNOB CONTROLS ====================
function initKnobs() {
    setupKnob(dom.pitchKnob, {
        min: -10, max: 10, val: 0, step: 1,
        onUpdate: v => {
            pitch = v;
            dom.pitchVal.textContent = v;
        }
    });
    
    setupKnob(dom.speedKnob, {
        min: 0.5, max: 1.5, val: 1.0, step: 0.1,
        onUpdate: v => {
            speed = v;
            dom.speedVal.textContent = v.toFixed(1) + 'x';
        }
    });
}

function setupKnob(el, opts) {
    let startY, startVal;
    const sens = 200;
    
    function start(e) {
        e.preventDefault();
        startY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;
        startVal = opts.val;
        document.addEventListener('mousemove', move);
        document.addEventListener('mouseup', end);
        document.addEventListener('touchmove', move);
        document.addEventListener('touchend', end);
    }
    
    function move(e) {
        const y = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;
        const delta = (startY - y) / sens;
        const range = opts.max - opts.min;
        let val = startVal + delta * range;
        val = Math.max(opts.min, Math.min(opts.max, val));
        val = Math.round(val / opts.step) * opts.step;
        
        const rot = ((val - opts.min) / range - 0.5) * 270;
        el.style.transform = `rotate(${rot}deg)`;
        opts.onUpdate(val);
        opts.val = val;
    }
    
    function end() {
        document.removeEventListener('mousemove', move);
        document.removeEventListener('mouseup', end);
        document.removeEventListener('touchmove', move);
        document.removeEventListener('touchend', end);
    }
    
    el.addEventListener('mousedown', start);
    el.addEventListener('touchstart', start);
}

// ==================== EQUALIZER ====================
function initEqualizer() {
    dom.eqContainer.innerHTML = '';
    
    eqBands.forEach((band, i) => {
        const wrapper = document.createElement('div');
        wrapper.className = 'flex flex-col items-center';
        
        const container = document.createElement('div');
        container.className = 'relative h-24 flex items-center justify-center';
        
        const track = document.createElement('div');
        track.className = 'eq-track';
        
        const fill = document.createElement('div');
        fill.className = 'eq-fill';
        fill.style.height = '50%';
        fill.id = `eqFill${i}`;
        track.appendChild(fill);
        
        const slider = document.createElement('input');
        slider.type = 'range';
        slider.min = -20;
        slider.max = 20;
        slider.value = 0;
        slider.step = 1;
        slider.className = 'eq-slider';
        slider.addEventListener('input', () => {
            updateEqFill(i, slider.value);
            if (isAudioProcessingInit && biquadFilters[i]) {
                biquadFilters[i].gain.value = slider.value;
            }
        });
        
        container.appendChild(track);
        container.appendChild(slider);
        
        const label = document.createElement('span');
        label.className = 'text-xs text-gray-600 mt-2';
        label.textContent = band >= 1000 ? `${band/1000}k` : band;
        
        wrapper.appendChild(container);
        wrapper.appendChild(label);
        dom.eqContainer.appendChild(wrapper);
    });
}

function updateEqFill(index, value) {
    const fill = $(`eqFill${index}`);
    if (fill) {
        const percentage = (parseFloat(value) + 20) / 40 * 100;
        fill.style.height = `${percentage}%`;
    }
}

function applyEqPreset(preset) {
    const values = eqPresets[preset];
    if (!values) return;
    
    // Update UI
    dom.eqPresets.querySelectorAll('button').forEach(btn => {
        const isActive = btn.dataset.preset === preset;
        btn.classList.toggle('bg-cyan-500/10', isActive);
        btn.classList.toggle('text-cyan-400', isActive);
        btn.classList.toggle('border-cyan-500/30', isActive);
        btn.classList.toggle('text-gray-400', !isActive);
        btn.classList.toggle('border-cyan-500/20', !isActive);
    });
    
    // Apply values
    const sliders = dom.eqContainer.querySelectorAll('input[type="range"]');
    values.forEach((val, i) => {
        if (sliders[i]) {
            sliders[i].value = val;
            updateEqFill(i, val);
            if (isAudioProcessingInit && biquadFilters[i]) {
                biquadFilters[i].gain.value = val;
            }
        }
    });
}

// ==================== HISTORY ====================
function addToHistory(item) {
    const entry = {
        id: Date.now(),
        text: item.text,
        url: item.url,
        engine: item.engine,
        time: new Date().toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' }),
        date: new Date().toLocaleDateString('zh-TW')
    };
    
    history.unshift(entry);
    if (history.length > 20) history.pop();
    
    renderHistory();
    updateRecentList();
    saveToStorage();
}

function renderHistory() {
    if (history.length === 0) {
        dom.historyList.innerHTML = `
            <div class="text-center py-12 text-gray-600">
                <svg class="w-20 h-20 mx-auto mb-4 opacity-20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                <p class="font-semibold">Â∞öÁÑ°Á¥ÄÈåÑ</p>
                <p class="text-sm mt-1">ÊÇ®ÁîüÊàêÁöÑÈü≥Ê™îÊúÉÈ°ØÁ§∫Âú®ÈÄôË£°</p>
            </div>
        `;
        return;
    }
    
    dom.historyList.innerHTML = history.map(h => `
        <div class="history-item p-3 flex items-center gap-3">
            <div class="flex-1 min-w-0">
                <div class="text-sm font-medium truncate">${h.text}</div>
                <div class="text-xs text-gray-500 flex items-center gap-2 mt-1">
                    <span>${h.date} ${h.time}</span>
                    <span class="px-2 py-0.5 rounded text-xs ${h.engine === 'elevenlabs' ? 'bg-purple-500/20 text-purple-400' : 'bg-cyan-500/20 text-cyan-400'}">${h.engine === 'elevenlabs' ? 'ElevenLabs' : 'Gemini'}</span>
                </div>
            </div>
            <div class="flex gap-2">
                <button class="w-9 h-9 rounded-full bg-black/30 border border-cyan-500/20 flex items-center justify-center hover:border-cyan-500/50 transition-all" onclick="playHistoryAudio('${h.url}')">
                    <svg class="w-4 h-4 text-cyan-400" fill="currentColor" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                </button>
                <button class="w-9 h-9 rounded-full bg-black/30 border border-cyan-500/20 flex items-center justify-center hover:border-cyan-500/50 transition-all" onclick="downloadHistoryAudio('${h.url}', '${h.time}')">
                    <svg class="w-4 h-4 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                </button>
            </div>
        </div>
    `).join('');
}

function updateRecentList() {
    if (history.length === 0) {
        dom.recentList.innerHTML = `
            <div class="text-center py-8 text-gray-600">
                <svg class="w-16 h-16 mx-auto mb-3 opacity-30" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/></svg>
                <p class="font-medium">Â∞öÁÑ°Á¥ÄÈåÑ</p>
                <p class="text-sm mt-1">ÈñãÂßãÂâµ‰ΩúÊÇ®ÁöÑÁ¨¨‰∏ÄÂÄã Podcast</p>
            </div>
        `;
        return;
    }
    
    dom.recentList.innerHTML = history.slice(0, 3).map(h => `
        <div class="history-item p-3 flex items-center gap-3">
            <div class="flex-1 min-w-0">
                <div class="text-sm font-medium truncate">${h.text}</div>
                <div class="text-xs text-gray-500 mt-1">${h.date} ${h.time}</div>
            </div>
            <button class="w-8 h-8 rounded-full bg-cyan-500/20 flex items-center justify-center" onclick="playHistoryAudio('${h.url}')">
                <svg class="w-4 h-4 text-cyan-400" fill="currentColor" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"/></svg>
            </button>
        </div>
    `).join('');
}

function playHistoryAudio(url) {
    if (url) {
        const audio = new Audio(url);
        audio.play();
    }
}

function downloadHistoryAudio(url, time) {
    if (url) {
        const a = document.createElement('a');
        a.href = url;
        a.download = `podcast_${time.replace(/:/g, '-')}.wav`;
        a.click();
    }
}

function clearAllHistory() {
    if (confirm('Á¢∫ÂÆöË¶ÅÊ∏ÖÈô§ÊâÄÊúâÁ¥ÄÈåÑÂóéÔºü')) {
        history = [];
        renderHistory();
        updateRecentList();
        saveToStorage();
        showToast('Á¥ÄÈåÑÂ∑≤Ê∏ÖÈô§', 'success');
    }
}

function mergeAllAudio() {
    if (history.length < 2) {
        showToast('ÈúÄË¶ÅËá≥Â∞ë 2 ÂÄãÈü≥Ê™îÊâçËÉΩÂêà‰Ωµ', 'error');
        return;
    }
    showToast('Âêà‰ΩµÂäüËÉΩÈñãÁôº‰∏≠', 'info');
}

// ==================== DOWNLOADS ====================
function downloadAudio() {
    if (!currentAudioUrl) {
        showToast('Ê≤íÊúâÂèØ‰∏ãËºâÁöÑÈü≥Ê™î', 'error');
        return;
    }
    
    const a = document.createElement('a');
    a.href = currentAudioUrl;
    a.download = `podcast_audio_${Date.now()}.wav`;
    a.click();
    showToast('Èü≥Ê™îÂ∑≤‰∏ãËºâ', 'success');
}

function downloadTxt() {
    const content = `Ê®ôÈ°åÂª∫Ë≠∞Ôºö\n${generatedTitles.join('\n')}\n\nÁØÄÁõÆÊëòË¶ÅÔºö\n${generatedSummary}\n\nPodcast ËÖ≥Êú¨Ôºö\n${generatedScript}`;
    const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `podcast_script_${Date.now()}.txt`;
    a.click();
    URL.revokeObjectURL(url);
    showToast('TXT Â∑≤‰∏ãËºâ', 'success');
}

function downloadPdf() {
    showToast('PDF ÁîüÊàê‰∏≠...', 'info');
    
    try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // Title
        doc.setFontSize(20);
        doc.text('AI Podcast Script', 105, 20, { align: 'center' });
        
        doc.setFontSize(12);
        let y = 40;
        
        // Titles
        doc.text('Suggested Titles:', 20, y);
        y += 10;
        generatedTitles.forEach((t, i) => {
            const lines = doc.splitTextToSize(`${i + 1}. ${t}`, 170);
            doc.text(lines, 25, y);
            y += lines.length * 7;
        });
        
        // Summary
        y += 10;
        doc.text('Show Notes:', 20, y);
        y += 10;
        const summaryLines = doc.splitTextToSize(generatedSummary, 170);
        doc.text(summaryLines, 20, y);
        y += summaryLines.length * 7;
        
        // Script
        if (y > 250) {
            doc.addPage();
            y = 20;
        }
        y += 10;
        doc.text('Script:', 20, y);
        y += 10;
        const scriptLines = doc.splitTextToSize(generatedScript, 170);
        
        scriptLines.forEach(line => {
            if (y > 280) {
                doc.addPage();
                y = 20;
            }
            doc.text(line, 20, y);
            y += 7;
        });
        
        doc.save(`podcast_script_${Date.now()}.pdf`);
        showToast('PDF Â∑≤‰∏ãËºâ', 'success');
    } catch (e) {
        showToast('PDF ÁîüÊàêÂ§±Êïó', 'error');
    }
}

// ==================== UTILITIES ====================
function copyText(elementId, text) {
    const content = text || $(elementId)?.textContent || '';
    navigator.clipboard.writeText(content).then(
        () => showToast('Â∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞ø', 'success'),
        () => showToast('Ë§áË£ΩÂ§±Êïó', 'error')
    );
}

let loadingTimer = null;
let loadingStartTime = 0;

function showLoading(text = 'ËôïÁêÜ‰∏≠...', progress = 0) {
    dom.loadingText.textContent = text;
    dom.loadingOverlay.classList.remove('hidden');
    
    const progressBar = document.getElementById('loadingProgress');
    const timeDisplay = document.getElementById('loadingTime');
    
    if (progressBar) {
        progressBar.style.width = progress > 0 ? `${progress}%` : '30%';
    }
    
    // Start timer
    loadingStartTime = Date.now();
    if (loadingTimer) clearInterval(loadingTimer);
    
    loadingTimer = setInterval(() => {
        const elapsed = ((Date.now() - loadingStartTime) / 1000).toFixed(1);
        if (timeDisplay) timeDisplay.textContent = `${elapsed}s`;
        
        // Animate progress bar if no specific progress
        if (progress === 0 && progressBar) {
            const currentWidth = parseFloat(progressBar.style.width) || 30;
            if (currentWidth < 90) {
                progressBar.style.width = `${currentWidth + 0.5}%`;
            }
        }
    }, 100);
}

function updateLoadingProgress(progress, text) {
    const progressBar = document.getElementById('loadingProgress');
    if (progressBar) {
        progressBar.style.width = `${Math.min(progress, 100)}%`;
    }
    if (text) {
        dom.loadingText.textContent = text;
    }
}

function hideLoading() {
    const progressBar = document.getElementById('loadingProgress');
    if (progressBar) {
        progressBar.style.width = '100%';
    }
    
    setTimeout(() => {
        dom.loadingOverlay.classList.add('hidden');
        if (progressBar) progressBar.style.width = '0%';
        if (loadingTimer) {
            clearInterval(loadingTimer);
            loadingTimer = null;
        }
    }, 200);
}

function showToast(msg, type = 'info') {
    dom.toast.textContent = msg;
    dom.toast.className = `toast ${type} show`;
    setTimeout(() => dom.toast.classList.remove('show'), 3000);
}

function saveToStorage() {
    localStorage.setItem('podcast_history', JSON.stringify(history.map(h => ({
        ...h,
        url: null
    }))));
}

function loadFromStorage() {
    const geminiKey = localStorage.getItem('gemini_api_key');
    if (geminiKey) {
        dom.geminiApiKey.value = geminiKey;
    }
    
    const elevenKey = localStorage.getItem('eleven_api_key');
    if (elevenKey) {
        dom.elevenApiKey.value = elevenKey;
    }
}

// ==================== INITIALIZE ====================
init();

// Hide splash screen after initialization
window.addEventListener('load', () => {
    setTimeout(() => {
        const splash = document.getElementById('splashScreen');
        if (splash) {
            splash.classList.add('hide');
            setTimeout(() => splash.remove(), 800);
        }
    }, 2500); // Show splash for 2.5 seconds
});
</script>
</body>
</html>
